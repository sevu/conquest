#define CE_MAP_GENERATOR_HCIV_Continents MAP_WIDTH MAP_HEIGHT ITERATIONS PLAYERS CASTLE_DISTANCE HILL_SIZE MAX_LAKES
     name=default
        map_width={MAP_WIDTH}
        map_height={MAP_HEIGHT}
        iterations=500
        hill_size=7
        max_lakes=3
        villages=1
        players={PLAYERS}
        min_lake_height=500
        lake_size=13
        river_frequency=13

		castle_size=4

		island_size=0

        temperature_iterations=1000
        temperature_size=7

        roads=3
        road_windiness=3

        #list of common terrain types which come in at
        #different heights, from highest to lowest
		[height]
            height=990
            terrain=Gg
        [/height]
        [height]
            height=100
            terrain=Gg
        [/height]
        [height]
            height=0
            terrain=Ww
        [/height]


	[convert]
            min_temperature=0
            max_temperature=100
			min_height=0
			max_height=1000
            from=Gg
            to=Ww
        [/convert]

			[convert]
            min_temperature=0
            max_temperature=200
			min_height=0
			max_height=200
            from=Ww
            to=Wo
        [/convert]
	###########################################
		[convert]
            min_temperature=300
            max_temperature=333
			min_height=650
			max_height=875
            from=Gg
            to=Hh
        [/convert]
		[convert]
            min_temperature=334
			max_temperature=366
            min_height=650
			max_height=875
            from=Gg
            to=Hh^Fp
        [/convert]
		#hills at high temperatures get forest on them 
        [convert]
            min_temperature=367
			max_temperature=400
            min_height=650
			max_height=875
            from=Gg
            to=Hh^Fdw
        [/convert]

        #fords appears on low land, at moderate temperatures
        [convert]
            min_temperature=200
            max_temperature=300
            max_height=150
            from=Gg
            to=Wwf
        [/convert]

		#snow appears instead of hills somewhere
        [convert]
            min_temperature=0
            max_temperature=300
            min_height=890
			max_height=920
            from=Hh
            to=Aa
        [/convert]

        #forest appears at moderate temperatures and is without hills at lower hights
        [convert]
            min_temperature=300
            max_temperature=400
			min_height=0
			max_height=200
            from=Gg
            to=Gg^Ftp
        [/convert]
        #desert appears at moderate temperatures and is without hills at heigher hights
        [convert]
            min_temperature=300
            max_temperature=350
			min_height=200
			max_height=650
            from=Gg
            to=Dd
        [/convert]
        [convert]
            min_temperature=350
            max_temperature=400
			min_height=200
			max_height=650
            from=Gg
            to=Dd^Ftd
        [/convert]
		#at highest temperatures and lower heights, grassland becomes desert 
        [convert]
            min_temperature=600
			max_temperature=925
			min_height=0
			max_height=450
            from=Gg
            to=Wwt
        [/convert]


		[convert]
            min_temperature=60
			max_temperature=90
			min_height=450
			max_height=700
            from=Gg
          ##  to=Gs^Fts
		  to=Ds
        [/convert]
		[convert]
            min_temperature=60
			max_temperature=90
			min_height=700
			max_height=800
            from=Gg
         to=Gs^Fts
		##  to=Ds
        [/convert]
		[convert]
            min_temperature=60
			max_temperature=90
			min_height=800
			max_height=900
            from=Gg
         to=Gs^Fds
		##  to=Ds
        [/convert]
				#tropical forest appears on the beach somewhere
        [convert]
            min_temperature=0
            max_temperature=300
            min_height=150
			max_height=200
            from=Ds
            to=Ds^Ftd
        [/convert]

		#swamps appear on average hights at average temperatures
        [convert]
            min_temperature=100
            max_temperature=400
			min_height=400
			max_height=420
			##max_height=500
            from=Gg
            to=Ss
        [/convert]
		#forests appear on average hights at average temperatures
        [convert]
            min_temperature=100
            max_temperature=400
			min_height=420
			max_height=500
			##max_height=500
            from=Gg
            to=Gs^Fds
        [/convert]

		#grass at lowest temperatures, get desert hills on them 
        [convert]
            min_temperature=100
			max_temperature=110
			min_height=0
			max_height=150
            from=Gg
            to=Ds
        [/convert]
        [convert]
            min_temperature=100
			max_temperature=110
			min_height=151
			max_height=300
            from=Gg
            to=Ds^Ftd
        [/convert]   
		[convert]
            min_temperature=106
			max_temperature=110
			min_height=301
			max_height=600
            from=Gg
            to=Hd^Ftd
        [/convert]
		[convert]
            min_temperature=100
			max_temperature=105
			min_height=301
			max_height=600
            from=Gg
            to=Hd
        [/convert]


		[convert]
            min_temperature=110
			max_temperature=150
			min_height=0
			max_height=333
            from=Gg
            to=Sm
        [/convert]
		[convert]
            min_temperature=110
			max_temperature=150
			min_height=334
			max_height=667
            from=Gg
            to=Gll^Es
        [/convert]
		[convert]
            min_temperature=110
			max_temperature=150
			min_height=668
			max_height=777
            from=Gg
            to=Wwrg
        [/convert]
		[convert]
            min_temperature=110
			max_temperature=150
			min_height=778
			max_height=1000
            from=Gg
            to=Ai
        [/convert]


		#instead of forest on very high height appear dry mountains
        [convert]
            min_temperature=300
            max_temperature=400
			min_height=850
			max_height=890
            from=Gg
            to=Md
        [/convert]

		#at high temperatures, grassland becomes drier
        [convert]
            min_temperature=400
			max_temperature=450
            from=Gg
            to=Gs
        [/convert]

		#at high temperatures, grassland becomes drier
        [convert]
            min_temperature=450
			max_temperature=500
            from=Gg
            to=Gs
        [/convert]

		#at highest temperatures and higher heights, grassland becomes mountains 
        [convert]
            min_temperature=925
			max_temperature=1000
			min_height=450
			max_height=890
            from=Gg
            to=Mm
        [/convert]


		#at high temperatures, grassland becomes dry
        [convert]
            min_temperature=500
			max_temperature=550
            from=Gg
            to=Gll
        [/convert]

		#at high temperatures and low heights, grassland becomes very dry
        [convert]
            min_temperature=550
			max_temperature=600
			min_height=0
			max_height=200
            from=Gg
            to=Gd
        [/convert]

		#at higher temperatures and higher heights, grassland becomes mountains
        [convert]
            min_temperature=625
			max_temperature=650
			min_height=550
			max_height=900
            from=Gg
            to=Md
        [/convert]


		#at lower temperatures and higher heights, grassland becomes swamp
        [convert]
            min_temperature=60
			max_temperature=90
			min_height=450
			max_height=900
            from=Gg
            to=Sm
        [/convert]

		#at lower temperatures and lower hights, grassland becomes fords  
        [convert]
            min_temperature=60
			max_temperature=90
			min_height=0
			max_height=450
            from=Gg
            to=Wwf
        [/convert]


		#at lower temperatures, grassland becomes ice (frozen lakes, rivers)
        [convert]
            min_temperature=30
			max_temperature=60
            from=Gg
            to=Wwt
        [/convert]
		#at lowest temperatures, grassland becomes shallow water
        [convert]
            min_temperature=15
			max_temperature=30
            from=Gg
            to=Ww
        [/convert]
		#at much lower temperatures, grassland becomes deep water (deep lakes)
        [convert]
            min_temperature=0
			max_temperature=15
            from=Gg
            to=Wo
        [/convert]


	##############################################
		[castle]
            valid_terrain=Gg,Gg^Fp,Gs,Gs^Fp,Hh,Hh^Fp,Wwf,Gs^Fts,Gd,Gll,Hhd,Md,Ss,Sm,Dd,Ds,Aa,Hd,Hd^Ftd,Wwt,Gg^Ftp,Gs^Fds
            min_distance={CASTLE_DISTANCE}
        [/castle]

        [village]
            terrain=Gg
            convert_to=Gg^Vh
            adjacent_liked=Gg, Ww, Ww, Ww, Ww, Ww, Ww, Ww, Ww^Bw|, Ww^Bw/, Ww^Bw\, Rr, Rr, Re, Re, Gg^Ve, Gg^Vh, Hh, Gs^Fp
            rating=8
        [/village]
        [village]
            terrain=Ds
            convert_to=Dd^Vda
            rating=2
            adjacent_liked=Gg, Ww, Ww, Ww, Ww^Bw|, Ww^Bw/, Ww^Bw\, Rr, Rr, Re, Re, Gg^Ve, Gg^Vh, Hh, Gs^Fp
        [/village]

        #villages in forest are Elvish
        [village]
            terrain=Gs^Fp
            convert_to=Gg^Ve
            rating=4
            adjacent_liked=Gg, Ww, Ww, Ww, Ww^Bw|, Ww^Bw/, Ww^Bw\, Rr, Rr, Re, Re, Gg^Ve, Gg^Vh, Hh, Gs^Fp, Gs^Fp, Gs^Fp
        [/village]
        [village]
            terrain=Hh
            convert_to=Hh^Vhh
            rating=4
            adjacent_liked=Gg, Ww, Ww, Ww, Ww^Bw|, Ww^Bw/, Ww^Bw\, Rr, Rr, Re, Re, Gg^Ve, Gg^Vh, Hh, Gs^Fp
        [/village]
        [village]
            terrain=Mm
            convert_to=Mm^Vhh
            rating=3
            adjacent_liked=Gg, Ww, Ww, Ww, Ww^Bw|, Ww^Bw/, Ww^Bw\, Rr, Rr, Re, Re, Gg^Ve, Gg^Vh, Hh, Gs^Fp
        [/village]

        #villages in snow
        [village]
            terrain=Aa
            convert_to=Aa^Vha
            rating=3
            adjacent_liked=Gg, Ww, Ww, Ww, Ww^Bw|, Ww^Bw/, Ww^Bw\, Rr, Rr, Re, Re, Gg^Ve, Gg^Vh, Hh, Gs^Fp
        [/village]

        [village]
            terrain=Aa^Fpa
            convert_to=Aa^Vha
            rating=3
            adjacent_liked=Gg, Ww, Ww, Ww, Ww^Bw|, Ww^Bw/, Ww^Bw\, Rr, Rr, Re, Re, Gg^Ve, Gg^Vh, Hh, Gs^Fp
        [/village]

        #swamp villages
        [village]
            terrain=Ss
            convert_to=Ss^Vhs
            rating=2
            adjacent_liked=Gg, Ww, Ww, Ww, Ww^Bw|, Ww^Bw/, Ww^Bw\, Rr, Rr, Re, Re, Gg^Ve, Gg^Vh, Hh, Gs^Fp
        [/village]

        #mermen villages - give them low chance of appearing
        [village]
            terrain=Ww
            convert_to=Ww^Vm
            rating=1
            adjacent_liked=Ww, Ww
        [/village]

        [naming]
            {VILLAGE_NAMES}
        [/naming]

        [village_naming]
            {VILLAGE_NAMES}
        [/village_naming]
#enddef

#define CE_MAP_EVENTS_HCIV_Continents

## europe 48x40 (60)(3)  gagarna 50x62 (90)(4.5)  wesnoth 51x47 (61)(5)   wales 70x76 (106)(5.5)   lotrando 49x50 (65)(4.5)
## random map 40x36
## ) start building villages in random clusters (1-12) with random names (Wonderland, England etc)
## ) distance between villages will depend on map size (ratio)
## 5.2) or distance between villages could be customized so number of villages will depend on that too
## 5.3) number of villages will depend on map size (ratio) or on custom distance 
## 5.4) if water is in radius 2, put village near water.
## 5.5) each cluster will be built around the center cluster village (if map borders dont let more than cluster amount of villages, then cluster will be decreased to amount that space allows)
## 6) need to setup number of players for each map..
## 7) amount of water on islands map should be adjustable ideally
## 8) add forest or hills around some cluster villages to create specific recruit type (elfs orcs)
## 8.1) first find which village already contains some hills or forest nearby.. if you dont need to add anything it will look more harmonic..
## 8.2) where you need to add forest to village, try to add more forest around that forest, randomly.


## 5.6) bonus vill depend on number of villages in cluster

	{CE_ALL_MAPS_SAME_MACRO}
	{OBJECTIVES_NOTE_MAP_BY _"Map by enclave randomly generated"}
	##
	{RECRUIT_MENU_HUMANS *^V*}
	##
	{GAME_MENU 1 1 0}
	##
	{CE_AI_EVENT} ## experimental AI to control AI side properly (maybe not working at all)

    [event]
        name=prestart
        {SCATTER_EMBELLISHMENTS Gg ^Efm 5}
        {SCATTER_EMBELLISHMENTS G*,D*,R*,Uu*,Ur* ^Es 2}
        {SCATTER_EMBELLISHMENTS G*,R*,Uu*,Ur* ^Em 2}
	    {SCATTER_EMBELLISHMENTS D* ^Edp 2}
        {SCATTER_EMBELLISHMENTS Gg^Fp ^Fet 2}
        {SCATTER_EMBELLISHMENTS Gg^Fp ^Fds 33}
        {SCATTER_EMBELLISHMENTS Gg^Fp ^Fms 50}
		{SCATTER_EMBELLISHMENTS Dd Dd^Do 2}

		{SCATTER_TERRAINS Gg,Gs Hh 15}
		{SCATTER_TERRAINS Gd,Gll Hhd 15}
		{SCATTER_TERRAINS Dd Hd 15}
		{SCATTER_TERRAINS Dd^Ftd Hd^Ftd 15}
		{SCATTER_TERRAINS Gg,Gs,Gll,Gd Mm 10}
		{SCATTER_TERRAINS Gs^Fds Hh^Fds 10}
		{SCATTER_TERRAINS Ww Wwr 2}

        {CE_CLEAR_MAP_LABELS}
		
		[lua]
		name="CE Continents"
		code = <<
		---local stamp_begin = wesnoth.get_time_stamp()
		------------------------------------------------
		local w,h,b = wesnoth.get_map_size()
		for i=0,w+1,1 do
			for j=h+1,h-1,-1 do
				wesnoth.set_terrain(i, j, "Xv")
			end
		end
		------------------
		local all_villages = wesnoth.get_villages()
		for i, pairs_locations in ipairs(all_villages) do
			wesnoth.set_terrain(pairs_locations[1],pairs_locations[2],"^","overlay")
		end
		for i,loc in ipairs(wesnoth.get_locations { terrain = "Ce,Ch,Kh,Co,Cv,Cud,Chr,Chw,Chs,Cd,Cdr,Ke,Ket,Kea,Ko,Kv,Kud,Khr,Khw,Khs,Kd,Kdr" }) do
			wesnoth.set_terrain(loc[1], loc[2], "Gg")
		end
		for i,loc in ipairs(wesnoth.get_locations { terrain = "Cha,Kha,Coa,Koa,Cea" }) do
			wesnoth.set_terrain(loc[1], loc[2], "Gs")
		end
		------------------
		for i=1,6,1 do
			wesnoth.units.to_map(wesnoth.get_units({ canrecruit = true })[i], w-2*i ,h)
		end
		wesnoth.delay(0)
		------------------
		---wesnoth.message("Placing Villages")
		local village_distance = helper.round((h+w)/2/10)
		local village_distance_tolerance = helper.round(village_distance/5)
		local ideal_village_count = helper.round((h+w)/2*1.4)
		--local average_bonus = helper.round(ideal_village_count/10)
		--local bonus_tolerance = helper.round(average_bonus/5)
		---wesnoth.message(tostring(village_distance))
		local end_of_village_placement = false
		local village_count = 0
		local count_attempts = 0
		while (end_of_village_placement==false) do
			count_attempts = count_attempts + 1
			local x = helper.rand("2.."..w-1)
			local y = helper.rand("2.."..h-3)
			if wesnoth.match_location(x, y, { terrain="G*,G*^*,H*,H*^*,S*,S*^*,R*,R*^*,M*,M*^*"}) == true then
				local random_village_location = wesnoth.get_locations { radius=tostring(village_distance), x=tostring(x), y=tostring(y) }
				if random_village_location then
					local other_village_present = false
					local potential_x = 0
					local potential_y = 0
					for i,loc in ipairs(random_village_location) do
						if wesnoth.match_location(loc[1], loc[2], { terrain="Gg^Vh" }) == true then
							other_village_present = true
							break
						end
					end
					if other_village_present == false then
						wesnoth.set_terrain(x, y, "Gg^Vh")
						wesnoth.delay(0)
						village_count = village_count + 1
					end
				end
				---if village_count >= ideal_village_count then
				if village_count >= ideal_village_count then
					end_of_village_placement = true
				end
				
		if count_attempts == 100 then
			village_distance = village_distance - 1
		end		
		if count_attempts == 200 then
			village_distance = village_distance - 1
		end	
		if count_attempts == 300 then
			village_distance = village_distance - 1
		end	
		if count_attempts == 400 then
			village_distance = village_distance - 1
		end	
		if count_attempts == 500 then
			village_distance = village_distance - 1
		end	
		if count_attempts >= 600 then
			end_of_village_placement = true
		end	
		if village_distance < 2 then
			end_of_village_placement = true
		end
				
		---		if count_attempts == 300 then
		---			village_distance = village_distance - village_distance_tolerance
		---		end
		---		if count_attempts >= 600 then
		---			end_of_village_placement = true
		---		end
				--- stick village in random place on map
				--- build cluster of villas around
			end
		end
		----------------------------------------------------
		---local stamp_end = wesnoth.get_time_stamp()
		---wesnoth.message(tostring(stamp_end-stamp_begin))
		wesnoth.delay(0)
		-----------------------------------------------------
		---wesnoth.message("Distributing bonuses")
		---local stamp_begin = wesnoth.get_time_stamp()
		---
	
	--- region names must not repeat!!!
	--- refresh bonus on start of game 
	--- option to select real names or fairy
	
		
		local random_names_generator_settings = wesnoth.get_variable("CE_SYSTEM.random_map_region_names")
		local random_names_generator_type = ""
		if random_names_generator_settings == 1 then 
			random_names_generator_type = helper.rand("Real,Fairy")
		else
			random_names_generator_type = random_names_generator_settings
		end
		--------------------------
		function generate_random_name()
			local random_region_name = ""
			if random_names_generator_type == "Real" then 
				random_region_name = helper.rand("England,Wales,Scotland,United States of America,Afghanistan,Albania,Algeria,Andorra,Angola,Argentina,Armenia,Australia,Austria,Azerbaijan,Bahamas,Bahrain,Bangladesh,Barbados, Belarus, Roman Empire, Belgium, Belize, Benin, Bhutan, Bolivia, Bosnia Herzegovina, Botswana, Brazil, Brunei, Bulgaria, Burkina, Burma, Burundi, Cambodia, Cameroon, Canada, Cape Verde, Central African Rep, Chad, Chile, People's Republic of China, Republic of China, Colombia, Comoros, Democratic Republic of the Congo, Republic of the Congo, Costa Rica,, Croatia, Cuba, Cyprus, Czech Republic, Danzig, Denmark, Djibouti, Dominica, Dominican Republic, East Timor, Ecuador, Egypt, El Salvador, Equatorial Guinea, Eritrea, Estonia, Ethiopia, Fiji, Finland, France, Gabon, Gaza Strip, The Gambia, Georgia, Germany, Ghana, Greece, Grenada, Guatemala, Guinea, Guinea-Bissau, Guyana, Haiti, Holy Roman Empire, Honduras, Hungary, Iceland, India, Indonesia, Iran, Iraq, Republic of Ireland, Israel, Italy, Ivory Coast, Jamaica, Japan, Jonathanland, Jordan, Kazakhstan, Kenya, Kiribati, North Korea, South Korea, Kosovo, Kuwait, Kyrgyzstan, Laos, Latvia, Lebanon, Lesotho, Liberia, Libya, Liechtenstein, Lithuania, Luxembourg, Macedonia, Madagascar, Malawi, Malaysia, Maldives, Mali, Malta, Marshall Islands, Mauritania, Mauritius, Mexico, Micronesia, Moldova, Monaco, Mongolia, Montenegro, Morocco, Mount Athos, Mozambique, Namibia, Nauru, Nepal, Newfoundland, Netherlands, New Zealand, Nicaragua, Niger, Nigeria, Norway, Oman, Ottoman Empire, Pakistan, Palau, Panama, Papua New Guinea, Paraguay, Peru, Philippines, Poland, Portugal, Prussia, Qatar, Romania, Rome, Russian Federation, Rwanda, St Lucia, Grenadines, Samoa, San Marino, Saudi Arabia, Senegal, Serbia, Seychelles, Sierra Leone, Singapore, Slovakia, Slovenia, Solomon Islands, Somalia, South Africa, Spain, Sri Lanka, Sudan, Suriname, Swaziland, Sweden, Switzerland, Syria, Tajikistan, Tanzania, Thailand, Togo, Tonga, Trinidad & Tobago, Tunisia, Turkey, Turkmenistan, Tuvalu, Uganda, Ukraine, United Arab Emirates, United Kingdom, Uruguay, Uzbekistan, Vanuatu, Vatican City, Venezuela, Vietnam, Yemen, Zambia, Zimbabwe")
			else
				random_region_name = helper.rand("Wonderland,Magical Fields,Holy Land,Rainbows,Stormy,Lepriconia,Unicorns,Beasts,Clouds,Rivers,Lakes,Oceans,Tunnels,Great Tunnels,Forgotten Land,Hell,Paradise,Hell Hole,Holy Dust,Pyramids,Triangle,Frozen Wings,Winterland,Golden Edge,Sandland,Diamonds,Emeralds,New Land,Hopeless Rainfall,Joyfull Beasts,Tropics,Arctics,Jingle Bells,Jungle Bells,Wizards,Temples of Buddha,Sunrise,Sunshine,Eclipse,On the Moon,The Light,The Dark,Shadows,Trojan Horses,Solar Flares,Thunders,Storms,Broken Dreams,Spiderland,The Claws,Royals,Fairies,Jagged Rocks,Seven Suns,Harlem,Salem,Foggy Gates,Hungry Frogs,Magic Storm,Big Meal,Gummy Bears,Polar Snow,Peasants,Revolving Doors,Fireflies,Dragons,Black Dragons,Red Dragons,Blue Dragons,Pale Dragons,Melting Point,Existance,Last Resistance,Last Resort,Reserved,Pinguins,Guinea Pigs,Hamsters,Angry Hamsters,Shaolin,Ninja,Greenland,Smiles,Luna,Moon,Destiny,Kingdom,Ezra,Alpha,Omega,Sparks,Wet Leafs,Blue Skies,Sweet Dreams,Summer Sweat,Summerland,Faint Smell,Full of Life,Second Chance,Fruits,Vegetables,Arms of Balloo,Centaurs,Centuries,Pigeons,Seagulls,Eagles,Tangerines,Gorillas,Monkeys,Tiger Fist,Hard as Rock,Soft Palms,Event Horisont,Goldilocks,Braveyard,El Gato,Summer Ray,The Blessing,Giraffas,Milky Way,Farmland,Healthy Crops,Tomatoes,Cucumbers,Carrots,Renegates,Domingo,Bacteria,Super Nova,Sierra,Kamasutra,Nuru,Bamboo,Stars,Shiny Stars,Lone Soles,Cherries,Christmas,New Land,Escape,Peaches,Plums,Utopia,Liquid Water,Vega,Wisky,Eyeballs,Next,Underground,Lime,Lemon,Odin,Raa,Monks,Cola,Afternoon,Cyrus,Andromeda,Twins,Hoplite,Phalanx,Legion,Pasture,Stoned,Phoenix,Beetles,Jawa,Hogar,Hogor,Hong,Hool,Horbag,Hork,Hort,Hoshnak,Hudash,Hudish,Hugor,Huk,Hulg,Hulo,Hunk,Huol,Hurag,Hurbag,Hurk,Hushnak,Huurk,Pagdish,Pagor,Palg,Palo,Paol,Parag,Pashnak,Pidush,Pigdish,Pigdush,Pilg,Pinak,Pink,Pirbag,Podash,Podish,Podush,Pogdish,Polg,Porbag,Porg,Pork,Port,Poshnak,Pradish,Pragdush,Pragor,Pralg,Pralo,Prang,Praol,Prarag,Prarbag,Prarg,Prark,Prart,Prashnak,Praurk,Pridish,Prigar,Prigdish,Prigor,Prilg,Prilo,Prinak,Priol,Prirbag,Prirg,Prirt,Priurk,Prodash,Prodish,Prodush,Prolg,Prolo,Pronak,Prong,Pronk,Prool,Prourk,Prudish,Prugar,Prugdish,Pruk,Prunak,Prunk,Prurg,Prurk,Pruurk,Puk,Pulg,Pulo,Punak,Pung,Punk,Purag,Purbag,Purg,Puurk,Radash,Ragar,Ragdish,Rak,Rang,Rank,Raol,Rarag,Rarbag,Rark,Rashnak,Raurk,Rigor,Rik,Rilg,Rinak,Rink,Rirg,Rirk,Rodish,Rodush,Rogdish,Rok,Rolo,Ronak,Rudash,Rugar,Rugdish,Ruk,Rung,Ruol,Rurag,Rushnak,Vadash,Vadish,Vadush,Vak,Valo,Vank,Varag,Varbag,Vigar,Vigdish,Vigor,Vilg,Vilo,Vink,Virag,Virt,Vishnak,Vogdish,Vogor,Vonak,Vong,Vorg,Vork,Voshnak,Vourk,Vradash,Vragar,Vragdush,Vragor,Vralo,Vrang,Vrarbag,Vrarg,Vrart,Vraurk,Vridash,Vridish,Vrigor,Vrik,Vrinak,Vring,Vrirt,Vrishnak,Vriurk,Vrodash,Vrodish,Vrogar,Vrogor,Vrolo,Vrong,Vrorg,Vrork,Vrudish,Vrugdush,Vrulg,Vrung,Vruol,Vrurg,Vrurt,Vruurk,Vudish,Vuk,Vulg,Vulo,Vunak,Vurag,Vurbag,Vurg,Vushnak") 
			end
			local string_find_i = string.find(random_region_name," ")
			if string_find_i==1 then random_region_name = string.gsub(random_region_name," ","",1) end
		return random_region_name
		end
		--------------------------
		---local w,h,b = wesnoth.get_map_size()
		---for i=0,w+1,1 do
		---	for j=h+1,h-1,-1 do
		---		wesnoth.set_terrain(i, j, "Xv")
		---	end
		---end
		
		village_distance = helper.round((h+w)/2/10)
		---local village_distance = helper.round((h+w)/2/10)
		---local village_distance_tolerance = helper.round(village_distance/5)
		---local ideal_village_count = helper.round((h+w)/2*1.4)
		local all_villas_on_map = wesnoth.get_villages()
		
		local average_bonus = helper.round(#all_villas_on_map/10)
		local bonus_tolerance = helper.round(average_bonus/5)
			
		function pick_a_city_name(choice)
			local english = helper.rand("Aberaeron,Aberdeen,Alloa,Antrim,Armagh,Ashton-under-Lyne,Aylesbury,Ayr,Ballymena,Banbridge,Bangor,Barnsley,Barri,Bath,Bedford,Belfast,Beverley,Bexleyheath,Birmingham,Blackburn,Blackpool,Bolton,Bournemouth,Bracknell,Bradford,Brighton,Bristol,Bromley,Bury,Caerfyrddin,Caernarfon,Camberwell,Cambridge,Camden Town,Cardiff,Carlisle,Catford,Chelmsford,Chester,Chichester,Chicksands,City of Westminster,Clydach Vale,Coleraine,Conwy,Cookstown,Coventry,Craigavon,Croydon,Dagenham,Dalkeith,Darlington,Derby,Doncaster,Dorchester,Dover,Downpatrick,Dudley,Dumbarton,Dumfries,Dundee,Dungannon,Durham,Ealing,East Ham,Ebbw Vale,Edinburgh,Elgin,Enfield,Enniskillen,Exeter,Falkirk,Forfar,Fort William,Gateshead,Giffnock,Glasgow,Glenrothes,Gloucester,Grays,Greenock,Grimsby,Hackney,Haddington,Halifax,Hamilton,Hammersmith,Harrow,Hartlepool,Hendon,Hereford,Hertford,Hounslow,Hove,Huddersfield,Hugh Town,Hwlffordd,Ilford,Inverness,Ipswich,Irvine,Islington,Kensington,Kilmarnock,Kingston upon Hull,Kingston upon Thames,Kirkintilloch,Kirkwall,Knowsley,Lambeth,Leeds,Leicester,Lerwick,Lewes,Lincoln,Lisburn,Liverpool,Livingston,Llandrindod Wells,Llangefni,Lochgilphead,London,Londonderry,Luton,Magherafelt,Maidenhead,Maidstone,Manchester,Matlock,Merthyr Tudful,Middlesbrough,Milton Keynes,Mold,Morden,Morpeth,Motherwell,Newbury,Newcastle,Newport,Newport,Newry,Newtown Saint Boswells,Newtownabbey,Northallerton,Northampton,Norwich,Nottingham,Oakham,Oldbury,Oldham,Omagh,Oxford,Paisley,Pen-y-Bont ar Ogwr,Penzance,Perth,Peterborough,Plymouth,Poole,Poplar,Port Talbot,Portsmouth,Preston,Reading,Rhuthun,Rochdale,Rochester,Romford,Rotherham,Saint Helens,Salford,Sandbach,Scarborough,Scunthorpe,Sheffield,Shrewsbury,Slough,Solihull,South Bank,South Shields,Southampton,Southend-on-Sea,Southport,Stafford,Stirling,Stockport,Stockton-on-Tees,Stoke,Stornoway,Strabane,Stretford,Sunderland,Sutton,Swansea,Swindon,Taunton,Telford,Thornbury,Torquay,Trowbridge,Truro,Twickenham,Usk,Uxbridge,Wakefield,Wallasey,Wallsend,Walsall,Walthamstow,Wandsworth,Warrington,Warwick,Wembley,Weston-super-Mare,Wick,Widnes,Wigan,Winchester,Wokingham,Wolverhampton,Wood Green,Woolwich,Worcester,Wrecsam,York,Ystrad Mynach")
			local russian = helper.rand("Volgodonsk,Saskylakh,Polevskoy,Saranpaul,Severnyy,Pervouralsk,Novy Port,Pugachev,Numto,Novy Urengoy,Novyy Uoyin,Nizhny Novgorod,Miass,Omsk,Naltchik,Mirnyy,Monchegorsk,Nyagan,Maykop,Kirensk,Kolpino,Khorgo,Kislovodsk,Guryevsk,Ivdel,Gusinoozyorsk,Kamenka,Kargat,Kasimov,Kolomna,Khanty,Mansiysk,Dimitrovgrad,Cheremkhovo,Gornyak,Blagodarnyy,Bodaybo,Biysk,Abakan,Angarsk,Birsk,Pskov,Smolensk,Put,Lenina,Kemerovo,Kolpashevo,Polyarnyy,St. Petersburg,Pyatigorsk,Nefteyugansk,Chernogorsk,Lensk,Krasnoarmeysk,Shira,Solnechnogorsk,Irkutsk,Noyabrsk,Yurga,Zelenokumsk,Olenek,Salekhard,Borovichi,Kaluga,Izhevsk,Volsk,Cherepovets,Pallasovka,Peregrebnoye,Tyumen,Toguchin,Nadym,Matochkin,Shar,Kurtamysh,Barnaul,Kimry,Elista,Gorno,Altaysk,Surgut,Cheboksary,Mariinsk,Safonovo,Sayanogorsk,Roslavl,Rubtsovsk,Laryak,Abaza,Velikiy,Novgorod,Klin,Bagdarin,Kovrov,Sokol,Engels,Gatchina,Nizhnyaya Tura,Mundybash,Prokopyevsk,Kiselevsk,Novokuznetsk,Luga,Moscow,Slavgorod,Kulunda,Krasnoturinsk,Vladikavkaz,Amderma,Varnek,Leninsk,Kuznetsky,Mozdok,Megion,Balashov,Zima,Samara,Igrim,Norilsk,Belebey,Kalachinsk,Vologda,Orenburg,Vyborg,Svetogorsk,Cherlak,Buzuluk,Kupina,Karasuk,Saransk,Barabinsk,Bukachacha,Alatyr,Shilka,Sherlovaya,Gora,Nerchinsk,Olovyannaya,Borzya,Bugulma,Strezhevoy,Nizhenvartovsk,Anzhero,Sudzhensk,Rayevskiy,Chita,Artemovskiy,Ryazan,Bezhetsk,Novomoskovsk,Zheleznogorsk,Alapayevsk,Starsy,Oskol,Rostov,Gubkin,Oktyabrskiy,Zheleznogorsk,Ilimskiy,Noginsk,Staraya Russa,Tikhvin,Asbest,Yoshkar,Ola,Ufa,Krasnokamensk,Orsk,Novotroitsk,Bologoye,Mikhaylovka,Chapayevsk,Novokuybishevsk,Tavda,Michurinsk,Serov,Alekseyevka,Valuyki,Tuymazy,Lgov,Rybinsk,Uglich,Slantsy,Vyska,Stavropol,Bryansk,Kropotkin,Shchekino,Derbent,Nikolayevsk,Tula,Murom,Plast,Kamyshin,Syzran,Kuznetsk,Gelendzhik,Sharya,Murmansk,Isikul,Frolovo,Severomorsk,Dzerzhinsk,Yalutorovsk,Uryupinsk,Golyshmanovo,Nazyvayevsk,Tatarsk,Sarapul,Tayshet,Nevinnomyssk,Velikiye,Luki,Nizhnekamsk,Kirov,Dyatkovo,Tara,Borisoglebsk,Klintsy,Mozhga,Rzhev,Naberezhnyye,Chelny,Vichuga,Mtsensk,Kanash,Topki,Shuya,Torzhok,Biryusinsk,Otradnyy,Serpukhov,Balakovo,Atkarsk,Kirovo-Chepetsk,Kirov,Serdobsk,Aleksin,Shumerlya,Yefremov,Buynaksk,Makhachkala,Yaroslavl,Sovetsk,Salavat,Sterlitamak,Bogoroditsk,Morshansk,Obninsk,Georgievsk,Sol-lletsk,Vladimir,Pechora,Ulyanovsk,Kirsanov,Kotovsk,Tambov,Volkhov,Vyshnniy,Volochek,Orel,Kandalaksha,Ussuriysk,Petrozavodsk,Votkinsk,Omutninsk,Novoaltaysk,Kirs,Kondopoga,Ruzayevka,Tver,Kotelnich,Kaliningrad,Penza,Velikiy Ustyug,Aleysk,Kineshma,Yegoryevsk,Volzhskiy,Volgograd,Onega,Cherepanovo,Apatity,Umba,Kovda,Kirovsk,Iskitim,Belgorod,Taganrog,Velsk,Sasovo,Voronezh,Syktyvkar,Krasnoufimsk,Lipetsk,Yelets,Ust,Kut,Magnitogorsk,Gryazi,Kazan,Arzamas,Kostroma,Zelenodolsk,Nizhneudinsk,Chistopol,Perm,Nizhny Tagil,Kem,Belomorsk,Ob,Novosibirsk,Cherkessk,Livny,Sibay,Kursk,Verkhnyaya,Salda,Naryan,Mar,Kyshtym,Krasnouralsk,Almetyevsk,Archangel,Verkhniy,Ufaley,Chusovoy,Nikel,Zlatoust,Nevyansk,Sochi,Novoshakhtinsk,Bugrino,Shakhty,Bataysk,Astrakhan,Kotlas,Indiga,Severouralsk,Akhtubinsk,Shoyna,Sosnogorsk,Shebekino,Ukhta,Yemanzhelinsk,Bakal,Troitsk,Yekaterinburg,Segezha,Kamensk,Uralskiy,Karpinsk,Usinsk,Kudymkar,Vikhorevka,Bratsk,Glazov,Solikamsk,Severodvinsk,Mednogorsk,Gay,Dombarovskiy,Kungur,Gubakha,Kurgan,Ust-Ulimsk,Slobodskoy,Kizel,Leninogorsk,Rostov,Orekhovo-Zuevo,Buguruslan,Turukhansk,Zmeinogorsk,Ulan,Ude,Teli,Asino,Vladivostok,Shadrinsk,Vorontsovo,Kyzyl,Tazovsky,Magas,Nazran,Groznyy,Krasnokamsk,Asha,Nelidovo,Ivanovo,Sergiyev,Posad,Tolyatti,Uelen,Skovorodino,Kyakhta,Zvezdnyy,Dalnerechensk,Bikin,Magdagachi,Shimanovsk,Zeya,Neftekamsk,Nordvik,Khatanga,Agapa,Yessey,Nakhodka,Partizansk,Kodinskiy,Khabarovsk,Boyarka,Savetskaya,Gavan,Uyar,Bogotol,Lesosibirsk,Noginsk,Artemovsk,Podkamennaya,Dikson,Igarka,Komsa,Kansk,Arsenyev,Starorybnoye,Zaozernyy,Achinsk,Omolon,Pevek,Mikhalkino,Lesozavodsk,Pokrovsk,Olyokminsk,Svobodnyy,Omsukchan,Tynda,Omchak,Progress,Belogorsk,Susuman,Amursk,Kavalerovo,Dalnegorsk,Ishim,Yakutsk,Kamenna,Obi,Severobaykalsk,Trofimovsk,Novorossiysk,Inta,Gyda,Uray,Tobolsk,Suntar,Vorkuta,Uzhur,Bilibino,Tiksi,Beringovskiy,Okha,Nogliki,Ambarchik,Spassk,Dalniy,Komsomolsk na Amure,Ust Kamchatsk,Sagastyr,Birobidzhan,Obluchye,Manily,Chersky,Oktyabrskiy,Chegdomyn,Evensk,Utkholok,Karamken,Kartaly,Siglan,Ust Nera,Pakhachi,Nakhodka,Magadan,Menkere,Strelka,Tunguskhaya,Sangar,Terbyas,Zhigansk,Vilyuysk,Verkhnevilyuysk,Klyuchi,Palatka,Krasnoyarsk,Mukhomornoye,Anadyr,Logashkino,Srednekolymsk,Zyryanka,Ayan,Vyazemskiy,Chumikan,Ugolnye Kopi,Ulkan,Zhilinda,Yeniseysk,Ust Olensk,Udachnyy,Chernyshevskiy,Okhotsk,Makarov,Dolinsk,Lavrentiya,Korsakov,Yuzhno Sakhalinsk,Khilok,Khandyga,Nikolayevsk na Amure,Ust Maya,Chagda,Eldikan,Verkhoyansk,Ust Kuyga,Poronaysk,Aldan,Uglegorsk,Nizhneyansk,Neryungri,Taksimo,Vanino,De Kastri,Provideniya,Tukchi,Nyukzha,Severo Kurilsk,Egvekinot,Khakhar,Batagay,Enurmino,Korf,Vitim,Timashevsk,Tikhoretsk,Tuapse,Apsheronsk,Yeysk,Labinsk,Yerema,Tomsk,Krasnogorsk,Kholmsk,Aleksandrovsk,Sakhalinskiy,Nevelsk,Zemlya,Bunge,Chokurdakh,Tulun,Chelyabinsk,Shalaurova,Mogocha,Petrovsk,Zabaykalskiy,Blagoveshchensk,Usolye,Sibirskoye,Gorod,Maykop,Krasnodar,Petropavlovsk,Kamchatskiy,Millerovo,Salsk,Belaya Kalitva,Kamensk,Shakhtinskiy,Chernyakhovsk,Sovetsk,Aginskoye,Tura,Palana,Dudinka,Novocherkassk,Kaspiysk")
			if choice == "1" then
				return english
			else
				return russian
			end
		end

local ideal_amount_of_regions = #all_villas_on_map / average_bonus
---for iii=1,5,1 do
local iii = 0
	local region_count = 0	
		local storage = {}
		
	for jj,loc_jj in ipairs(all_villas_on_map) do
		
		local total_villages_count = 0
		
		function check_storage(xx1,yy1)
			local storage_result = false
			if storage then
				for ii=1,#storage,1 do
					if storage[ii][1] == xx1 then
						if storage[ii][2] == yy1 then
							storage_result = true
						end
					end
				end
			end
		return storage_result
		end
		
		function add_to_storage(xx1,yy1,random_reg_name)
			if storage[1] then
				storage[#storage+1] = {}
				storage[#storage][1] = xx1
				storage[#storage][2] = yy1
				storage[#storage][3] = random_reg_name
			else
				storage[1] = {}
				storage[1][1] = xx1
				storage[1][2] = yy1
				storage[1][3] = random_reg_name
			end
		end
		
		function check_range_to_next_village(x1,y1,random_reg_name)
			for cc,loc_cc in ipairs(all_villas_on_map) do
				if total_villages_count <= (average_bonus + bonus_tolerance) then
					local distance_villa_to_villa = wesnoth.map.distance_between({ x1, y1 }, { loc_cc[1], loc_cc[2] })
					if distance_villa_to_villa <= (village_distance+iii) then
						if (x1 ~= loc_cc[1] or y1 ~= loc_cc[2]) then
							if check_storage(loc_cc[1],loc_cc[2]) == false then
								add_to_storage(loc_cc[1],loc_cc[2],random_reg_name)
								total_villages_count = total_villages_count + 1
								check_range_to_next_village(loc_cc[1],loc_cc[2],random_reg_name)
								-- if too many bonus regions then increase distance
							end
						end
					end
				else 
					break
				end
			end
		end
		
		
		--- this is generating random region name and making sure it is not duplicated
		local region_name_duplicated = true
		local random_reg_name = ""
		while (region_name_duplicated == true) do
			random_reg_name = generate_random_name()
			---
			local found_in_storage = false
			if storage then
				for ii=1,#storage,1 do
					if storage[ii][3] == random_reg_name then
						found_in_storage = true
					end
				end
			end
			---
			if found_in_storage == false then 
				region_name_duplicated = false 
				break
			end
		end
	
		--local random_reg_name = generate_random_name()
		---local random_reg_name = helper.rand("England,Wales,Scotland,United States of America,Afghanistan,Albania,Algeria,Andorra,Angola,Argentina,Armenia,Australia,Austria,Azerbaijan,Bahamas,Bahrain,Bangladesh,Barbados, Belarus, Roman Empire, Belgium, Belize, Benin, Bhutan, Bolivia, Bosnia Herzegovina, Botswana, Brazil, Brunei, Bulgaria, Burkina, Burma, Burundi, Cambodia, Cameroon, Canada, Cape Verde, Central African Rep, Chad, Chile, People's Republic of China, Republic of China, Colombia, Comoros, Democratic Republic of the Congo, Republic of the Congo, Costa Rica,, Croatia, Cuba, Cyprus, Czech Republic, Danzig, Denmark, Djibouti, Dominica, Dominican Republic, East Timor, Ecuador, Egypt, El Salvador, Equatorial Guinea, Eritrea, Estonia, Ethiopia, Fiji, Finland, France, Gabon, Gaza Strip, The Gambia, Georgia, Germany, Ghana, Greece, Grenada, Guatemala, Guinea, Guinea-Bissau, Guyana, Haiti, Holy Roman Empire, Honduras, Hungary, Iceland, India, Indonesia, Iran, Iraq, Republic of Ireland, Israel, Italy, Ivory Coast, Jamaica, Japan, Jonathanland, Jordan, Kazakhstan, Kenya, Kiribati, North Korea, South Korea, Kosovo, Kuwait, Kyrgyzstan, Laos, Latvia, Lebanon, Lesotho, Liberia, Libya, Liechtenstein, Lithuania, Luxembourg, Macedonia, Madagascar, Malawi, Malaysia, Maldives, Mali, Malta, Marshall Islands, Mauritania, Mauritius, Mexico, Micronesia, Moldova, Monaco, Mongolia, Montenegro, Morocco, Mount Athos, Mozambique, Namibia, Nauru, Nepal, Newfoundland, Netherlands, New Zealand, Nicaragua, Niger, Nigeria, Norway, Oman, Ottoman Empire, Pakistan, Palau, Panama, Papua New Guinea, Paraguay, Peru, Philippines, Poland, Portugal, Prussia, Qatar, Romania, Rome, Russian Federation, Rwanda, St Lucia, Grenadines, Samoa, San Marino, Saudi Arabia, Senegal, Serbia, Seychelles, Sierra Leone, Singapore, Slovakia, Slovenia, Solomon Islands, Somalia, South Africa, Spain, Sri Lanka, Sudan, Suriname, Swaziland, Sweden, Switzerland, Syria, Tajikistan, Tanzania, Thailand, Togo, Tonga, Trinidad & Tobago, Tunisia, Turkey, Turkmenistan, Tuvalu, Uganda, Ukraine, United Arab Emirates, United Kingdom, Uruguay, Uzbekistan, Vanuatu, Vatican City, Venezuela, Vietnam, Yemen, Zambia, Zimbabwe")
		---local string_find_i = string.find(random_reg_name," ")
		---if string_find_i==1 then random_reg_name = string.gsub(random_reg_name," ","",1) end
		
		-- in future ideally delete +1 regions and try to increase distance to +3 maybe they become +2 or +3 or +4 just for those
				
		local x01 = loc_jj[1]
		local y01 = loc_jj[2]
		
		if check_storage(x01,y01) == false then
			region_count = region_count + 1
			add_to_storage(x01,y01,random_reg_name)
			total_villages_count = total_villages_count + 1
			check_range_to_next_village(x01,y01,random_reg_name)
			local random_extra_bonus = helper.rand("1,2")
			local city_theme = helper.rand("1,2")
			local slowthinker_string_village_list = ""
			local slowthinker_bonus = total_villages_count
			for kk=#storage,#storage-total_villages_count+1,-1 do
				if total_villages_count > 1 then
					slowthinker_bonus = total_villages_count+random_extra_bonus
				end
				if kk == #storage then
					slowthinker_string_village_list = pick_a_city_name(city_theme)..","..storage[kk][1]..","..storage[kk][2]
				else
					slowthinker_string_village_list = slowthinker_string_village_list..","..pick_a_city_name(city_theme)..","..storage[kk][1]..","..storage[kk][2]
				end
			end
						function slowthinker_region(region_name,region_bonus,village_list)
							local region_codename = region_name
							-- may be bug with double empty spaces or double "-" signs in same region name etc
							if string.find(region_codename," ") then region_codename = string.gsub(region_codename," ","_") end
							if string.find(region_codename,"'") then region_codename = string.gsub(region_codename,"'","_") end
							if string.find(region_codename,"/") then region_codename = string.gsub(region_codename,"/","_") end
							if string.find(region_codename,"-") then region_codename = string.gsub(region_codename,"-","_") end
							---
							local lua_regions_length = wesnoth.get_variable("CE_SYSTEM.regions.length")
							if lua_regions_length then
							else lua_regions_length = 0
							end
							---
							wesnoth.set_variable("CE_SYSTEM.regions_"..tostring(region_codename).."_bonus",tostring(region_bonus))
							wesnoth.set_variable("CE_SYSTEM.regions_"..tostring(region_codename).."array_num",tostring(lua_regions_length))
							wesnoth.set_variable("CE_SYSTEM.regions["..tostring(lua_regions_length).."].id",tostring(region_codename))
							wesnoth.set_variable("CE_SYSTEM.regions["..tostring(lua_regions_length).."].bonus",tostring(region_bonus))
							wesnoth.set_variable("CE_SYSTEM.regions["..tostring(lua_regions_length).."].name",tostring(region_name))
							---
							local lua_previous = "y"
							local lua_village_x = -1
							local lua_village_y = -1
							local lua_village_name = "empty"
						-----------------------------------------------------------	
							local j = 0
							for eachword in string.gmatch(village_list, "([^,]+)") do
								j = j + 1
								if tonumber(eachword) ~= nil then
									if lua_previous == "string" then
										lua_previous = "x"
										lua_village_x = eachword
									else
										lua_previous = "y"
										lua_village_y = eachword
									end
								else
									lua_previous = "string"
									lua_village_name = eachword
								end
								-----------------------------------------------------
								if lua_previous == "y" then
								--------------------
									local lua_villages_length = wesnoth.get_variable("CE_SYSTEM.regions_"..tostring(region_codename)..".length")
									if lua_villages_length then
									else lua_villages_length = 0
									end
									---
									wesnoth.set_variable("CE_SYSTEM.regions_"..tostring(region_codename).."["..tostring(lua_villages_length).."].name",tostring(lua_village_name))
									wesnoth.set_variable("CE_SYSTEM.regions_"..tostring(region_codename).."["..tostring(lua_villages_length).."].x",tostring(lua_village_x))
									wesnoth.set_variable("CE_SYSTEM.regions_"..tostring(region_codename).."["..tostring(lua_villages_length).."].y",tostring(lua_village_y))
									wesnoth.set_variable("CE_SYSTEM.regions_city_"..tostring(lua_village_x).."_"..tostring(lua_village_y)..".name",tostring(lua_village_name))
									wesnoth.set_variable("CE_SYSTEM.regions_city_"..tostring(lua_village_x).."_"..tostring(lua_village_y)..".region_id",tostring(region_codename))
									wesnoth.set_variable("CE_SYSTEM.regions_city_"..tostring(lua_village_x).."_"..tostring(lua_village_y)..".array_num",tostring(lua_villages_length))
									---
									if wesnoth.get_variable("CE_SYSTEM.show_village_labels_in_fog") == true then
									wesnoth.fire("label", { text=tostring(lua_village_name).." ("..tostring(region_name).." +"..tostring(region_bonus)..")", color="200,200,200", x=tostring(lua_village_x), y=tostring(lua_village_y), category="", immutable="yes", side="0", team_name="", tooltip="", visible_in_fog="yes", visible_in_shroud="no" } )
									else
									wesnoth.fire("label", { text=tostring(lua_village_name).." ("..tostring(region_name).." +"..tostring(region_bonus)..")", color="200,200,200", x=tostring(lua_village_x), y=tostring(lua_village_y), category="", immutable="yes", side="0", team_name="", tooltip="", visible_in_fog="no", visible_in_shroud="no" } )
									end
									-------------
								else 
								end
							end
						--------------------------------------------------
						end
			slowthinker_region(tostring(random_reg_name),tostring(slowthinker_bonus),tostring(slowthinker_string_village_list))
			---wesnoth.message(tostring(village_distance)..","..tostring(iii))
			---wesnoth.delay(1000)
		end
	end
		---
		---local stamp_end = wesnoth.get_time_stamp()
		---wesnoth.message(tostring(stamp_end-stamp_begin))
		-----------------------------------------------------
		>> 
		[/lua]

	[/event]
	
	##OOS_FIX_FOR_RANDOM_MAP_GENERATOR_EVENT
	[event]
	name=turn 1
		[store_unit]
		[filter]
		[/filter]
		variable=CE_oos_1.all_units
		kill=yes
		[/store_unit]
		######################
		[lua]
		code = <<
		local result = wesnoth.synchronize_choice(
		function()
		return wesnoth.get_variable("CE_oos_1")
		end
		)
		wesnoth.set_variable("CE_oos_1", result)
		>>
		[/lua]
		######################
		[foreach]
		array=CE_oos_1.all_units
		[do]
		[unstore_unit]
		variable=this_item
		animate=no
		[/unstore_unit]
		[/do]
		[/foreach]
		#######################
		{CLEAR_VARIABLE CE_oos_1}
		[place_shroud]
		side=1,2,3,4,5,6,7,8,9
		[/place_shroud]
		[reset_fog]
		[filter_side]
		side=1,2,3,4,5,6,7,8,9
		[/filter_side]
		reset_view=yes
		[/reset_fog]
		[redraw]
		clear_shroud=yes
		[/redraw]
	[/event]
#enddef




























#define UNUSEDSHITJFKJFJFJFJFJFJFDLKJFLELELEL
## works as intended but need to move into automatic event
[set_menu_item]
		id=aaa_ce_testregion
		description=_"<b>Test Region.</b>"
		image=themes/villages.png
		[command]
			[lua]
			code = <<
		local w,h,b = wesnoth.get_map_size()
		for i=0,w+1,1 do
			for j=h+1,h-1,-1 do
				wesnoth.set_terrain(i, j, "Xv")
			end
		end
		
		local village_distance = helper.round((h+w)/2/10)
		local village_distance_tolerance = helper.round(village_distance/5)
		local ideal_village_count = helper.round((h+w)/2*1.4)
		local all_villas_on_map = wesnoth.get_villages()
		
		local average_bonus = helper.round(#all_villas_on_map/10)
		local bonus_tolerance = helper.round(average_bonus/5)
			
		function pick_a_city_name(choice)
			local english = helper.rand("Aberaeron,Aberdeen,Alloa,Antrim,Armagh,Ashton-under-Lyne,Aylesbury,Ayr,Ballymena,Banbridge,Bangor,Barnsley,Barri,Bath,Bedford,Belfast,Beverley,Bexleyheath,Birmingham,Blackburn,Blackpool,Bolton,Bournemouth,Bracknell,Bradford,Brighton,Bristol,Bromley,Bury,Caerfyrddin,Caernarfon,Camberwell,Cambridge,Camden Town,Cardiff,Carlisle,Catford,Chelmsford,Chester,Chichester,Chicksands,City of Westminster,Clydach Vale,Coleraine,Conwy,Cookstown,Coventry,Craigavon,Croydon,Dagenham,Dalkeith,Darlington,Derby,Doncaster,Dorchester,Dover,Downpatrick,Dudley,Dumbarton,Dumfries,Dundee,Dungannon,Durham,Ealing,East Ham,Ebbw Vale,Edinburgh,Elgin,Enfield,Enniskillen,Exeter,Falkirk,Forfar,Fort William,Gateshead,Giffnock,Glasgow,Glenrothes,Gloucester,Grays,Greenock,Grimsby,Hackney,Haddington,Halifax,Hamilton,Hammersmith,Harrow,Hartlepool,Hendon,Hereford,Hertford,Hounslow,Hove,Huddersfield,Hugh Town,Hwlffordd,Ilford,Inverness,Ipswich,Irvine,Islington,Kensington,Kilmarnock,Kingston upon Hull,Kingston upon Thames,Kirkintilloch,Kirkwall,Knowsley,Lambeth,Leeds,Leicester,Lerwick,Lewes,Lincoln,Lisburn,Liverpool,Livingston,Llandrindod Wells,Llangefni,Lochgilphead,London,Londonderry,Luton,Magherafelt,Maidenhead,Maidstone,Manchester,Matlock,Merthyr Tudful,Middlesbrough,Milton Keynes,Mold,Morden,Morpeth,Motherwell,Newbury,Newcastle,Newport,Newport,Newry,Newtown Saint Boswells,Newtownabbey,Northallerton,Northampton,Norwich,Nottingham,Oakham,Oldbury,Oldham,Omagh,Oxford,Paisley,Pen-y-Bont ar Ogwr,Penzance,Perth,Peterborough,Plymouth,Poole,Poplar,Port Talbot,Portsmouth,Preston,Reading,Rhuthun,Rochdale,Rochester,Romford,Rotherham,Saint Helens,Salford,Sandbach,Scarborough,Scunthorpe,Sheffield,Shrewsbury,Slough,Solihull,South Bank,South Shields,Southampton,Southend-on-Sea,Southport,Stafford,Stirling,Stockport,Stockton-on-Tees,Stoke,Stornoway,Strabane,Stretford,Sunderland,Sutton,Swansea,Swindon,Taunton,Telford,Thornbury,Torquay,Trowbridge,Truro,Twickenham,Usk,Uxbridge,Wakefield,Wallasey,Wallsend,Walsall,Walthamstow,Wandsworth,Warrington,Warwick,Wembley,Weston-super-Mare,Wick,Widnes,Wigan,Winchester,Wokingham,Wolverhampton,Wood Green,Woolwich,Worcester,Wrecsam,York,Ystrad Mynach")
			local russian = helper.rand("Volgodonsk,Saskylakh,Polevskoy,Saranpaul,Severnyy,Pervouralsk,Novy Port,Pugachev,Numto,Novy Urengoy,Novyy Uoyin,Nizhny Novgorod,Miass,Omsk,Naltchik,Mirnyy,Monchegorsk,Nyagan,Maykop,Kirensk,Kolpino,Khorgo,Kislovodsk,Guryevsk,Ivdel,Gusinoozyorsk,Kamenka,Kargat,Kasimov,Kolomna,Khanty,Mansiysk,Dimitrovgrad,Cheremkhovo,Gornyak,Blagodarnyy,Bodaybo,Biysk,Abakan,Angarsk,Birsk,Pskov,Smolensk,Put,Lenina,Kemerovo,Kolpashevo,Polyarnyy,St. Petersburg,Pyatigorsk,Nefteyugansk,Chernogorsk,Lensk,Krasnoarmeysk,Shira,Solnechnogorsk,Irkutsk,Noyabrsk,Yurga,Zelenokumsk,Olenek,Salekhard,Borovichi,Kaluga,Izhevsk,Volsk,Cherepovets,Pallasovka,Peregrebnoye,Tyumen,Toguchin,Nadym,Matochkin,Shar,Kurtamysh,Barnaul,Kimry,Elista,Gorno,Altaysk,Surgut,Cheboksary,Mariinsk,Safonovo,Sayanogorsk,Roslavl,Rubtsovsk,Laryak,Abaza,Velikiy,Novgorod,Klin,Bagdarin,Kovrov,Sokol,Engels,Gatchina,Nizhnyaya Tura,Mundybash,Prokopyevsk,Kiselevsk,Novokuznetsk,Luga,Moscow,Slavgorod,Kulunda,Krasnoturinsk,Vladikavkaz,Amderma,Varnek,Leninsk,Kuznetsky,Mozdok,Megion,Balashov,Zima,Samara,Igrim,Norilsk,Belebey,Kalachinsk,Vologda,Orenburg,Vyborg,Svetogorsk,Cherlak,Buzuluk,Kupina,Karasuk,Saransk,Barabinsk,Bukachacha,Alatyr,Shilka,Sherlovaya,Gora,Nerchinsk,Olovyannaya,Borzya,Bugulma,Strezhevoy,Nizhenvartovsk,Anzhero,Sudzhensk,Rayevskiy,Chita,Artemovskiy,Ryazan,Bezhetsk,Novomoskovsk,Zheleznogorsk,Alapayevsk,Starsy,Oskol,Rostov,Gubkin,Oktyabrskiy,Zheleznogorsk,Ilimskiy,Noginsk,Staraya Russa,Tikhvin,Asbest,Yoshkar,Ola,Ufa,Krasnokamensk,Orsk,Novotroitsk,Bologoye,Mikhaylovka,Chapayevsk,Novokuybishevsk,Tavda,Michurinsk,Serov,Alekseyevka,Valuyki,Tuymazy,Lgov,Rybinsk,Uglich,Slantsy,Vyska,Stavropol,Bryansk,Kropotkin,Shchekino,Derbent,Nikolayevsk,Tula,Murom,Plast,Kamyshin,Syzran,Kuznetsk,Gelendzhik,Sharya,Murmansk,Isikul,Frolovo,Severomorsk,Dzerzhinsk,Yalutorovsk,Uryupinsk,Golyshmanovo,Nazyvayevsk,Tatarsk,Sarapul,Tayshet,Nevinnomyssk,Velikiye,Luki,Nizhnekamsk,Kirov,Dyatkovo,Tara,Borisoglebsk,Klintsy,Mozhga,Rzhev,Naberezhnyye,Chelny,Vichuga,Mtsensk,Kanash,Topki,Shuya,Torzhok,Biryusinsk,Otradnyy,Serpukhov,Balakovo,Atkarsk,Kirovo-Chepetsk,Kirov,Serdobsk,Aleksin,Shumerlya,Yefremov,Buynaksk,Makhachkala,Yaroslavl,Sovetsk,Salavat,Sterlitamak,Bogoroditsk,Morshansk,Obninsk,Georgievsk,Sol-lletsk,Vladimir,Pechora,Ulyanovsk,Kirsanov,Kotovsk,Tambov,Volkhov,Vyshnniy,Volochek,Orel,Kandalaksha,Ussuriysk,Petrozavodsk,Votkinsk,Omutninsk,Novoaltaysk,Kirs,Kondopoga,Ruzayevka,Tver,Kotelnich,Kaliningrad,Penza,Velikiy Ustyug,Aleysk,Kineshma,Yegoryevsk,Volzhskiy,Volgograd,Onega,Cherepanovo,Apatity,Umba,Kovda,Kirovsk,Iskitim,Belgorod,Taganrog,Velsk,Sasovo,Voronezh,Syktyvkar,Krasnoufimsk,Lipetsk,Yelets,Ust,Kut,Magnitogorsk,Gryazi,Kazan,Arzamas,Kostroma,Zelenodolsk,Nizhneudinsk,Chistopol,Perm,Nizhny Tagil,Kem,Belomorsk,Ob,Novosibirsk,Cherkessk,Livny,Sibay,Kursk,Verkhnyaya,Salda,Naryan,Mar,Kyshtym,Krasnouralsk,Almetyevsk,Archangel,Verkhniy,Ufaley,Chusovoy,Nikel,Zlatoust,Nevyansk,Sochi,Novoshakhtinsk,Bugrino,Shakhty,Bataysk,Astrakhan,Kotlas,Indiga,Severouralsk,Akhtubinsk,Shoyna,Sosnogorsk,Shebekino,Ukhta,Yemanzhelinsk,Bakal,Troitsk,Yekaterinburg,Segezha,Kamensk,Uralskiy,Karpinsk,Usinsk,Kudymkar,Vikhorevka,Bratsk,Glazov,Solikamsk,Severodvinsk,Mednogorsk,Gay,Dombarovskiy,Kungur,Gubakha,Kurgan,Ust-Ulimsk,Slobodskoy,Kizel,Leninogorsk,Rostov,Orekhovo-Zuevo,Buguruslan,Turukhansk,Zmeinogorsk,Ulan,Ude,Teli,Asino,Vladivostok,Shadrinsk,Vorontsovo,Kyzyl,Tazovsky,Magas,Nazran,Groznyy,Krasnokamsk,Asha,Nelidovo,Ivanovo,Sergiyev,Posad,Tolyatti,Uelen,Skovorodino,Kyakhta,Zvezdnyy,Dalnerechensk,Bikin,Magdagachi,Shimanovsk,Zeya,Neftekamsk,Nordvik,Khatanga,Agapa,Yessey,Nakhodka,Partizansk,Kodinskiy,Khabarovsk,Boyarka,Savetskaya,Gavan,Uyar,Bogotol,Lesosibirsk,Noginsk,Artemovsk,Podkamennaya,Dikson,Igarka,Komsa,Kansk,Arsenyev,Starorybnoye,Zaozernyy,Achinsk,Omolon,Pevek,Mikhalkino,Lesozavodsk,Pokrovsk,Olyokminsk,Svobodnyy,Omsukchan,Tynda,Omchak,Progress,Belogorsk,Susuman,Amursk,Kavalerovo,Dalnegorsk,Ishim,Yakutsk,Kamenna,Obi,Severobaykalsk,Trofimovsk,Novorossiysk,Inta,Gyda,Uray,Tobolsk,Suntar,Vorkuta,Uzhur,Bilibino,Tiksi,Beringovskiy,Okha,Nogliki,Ambarchik,Spassk,Dalniy,Komsomolsk na Amure,Ust Kamchatsk,Sagastyr,Birobidzhan,Obluchye,Manily,Chersky,Oktyabrskiy,Chegdomyn,Evensk,Utkholok,Karamken,Kartaly,Siglan,Ust Nera,Pakhachi,Nakhodka,Magadan,Menkere,Strelka,Tunguskhaya,Sangar,Terbyas,Zhigansk,Vilyuysk,Verkhnevilyuysk,Klyuchi,Palatka,Krasnoyarsk,Mukhomornoye,Anadyr,Logashkino,Srednekolymsk,Zyryanka,Ayan,Vyazemskiy,Chumikan,Ugolnye Kopi,Ulkan,Zhilinda,Yeniseysk,Ust Olensk,Udachnyy,Chernyshevskiy,Okhotsk,Makarov,Dolinsk,Lavrentiya,Korsakov,Yuzhno Sakhalinsk,Khilok,Khandyga,Nikolayevsk na Amure,Ust Maya,Chagda,Eldikan,Verkhoyansk,Ust Kuyga,Poronaysk,Aldan,Uglegorsk,Nizhneyansk,Neryungri,Taksimo,Vanino,De Kastri,Provideniya,Tukchi,Nyukzha,Severo Kurilsk,Egvekinot,Khakhar,Batagay,Enurmino,Korf,Vitim,Timashevsk,Tikhoretsk,Tuapse,Apsheronsk,Yeysk,Labinsk,Yerema,Tomsk,Krasnogorsk,Kholmsk,Aleksandrovsk,Sakhalinskiy,Nevelsk,Zemlya,Bunge,Chokurdakh,Tulun,Chelyabinsk,Shalaurova,Mogocha,Petrovsk,Zabaykalskiy,Blagoveshchensk,Usolye,Sibirskoye,Gorod,Maykop,Krasnodar,Petropavlovsk,Kamchatskiy,Millerovo,Salsk,Belaya Kalitva,Kamensk,Shakhtinskiy,Chernyakhovsk,Sovetsk,Aginskoye,Tura,Palana,Dudinka,Novocherkassk,Kaspiysk")
			if choice == "1" then
				return english
			else
				return russian
			end
		end

local ideal_amount_of_regions = #all_villas_on_map / average_bonus
---for iii=1,5,1 do
local iii = 1
	local region_count = 0	
		local storage = {}
		
		
		
		-- while region counter > (village_count / average_bonus * 2) do increase region distance 
		-- if region_distance > 10 then break
		-- region counter = 0
		-- for i,loc,allvillages in pairs bla bla
		-- repeat below thing for all villages on map
		-- skip the village with already assigned region name
		-- create bonus amount depending on village counter. 
		-- (1 village +1)(2 villages +2 or +3) (3 villages +3+4) (4 villages +4+5+6) (5 villages +5+6+7)
		
	for jj,loc_jj in ipairs(all_villas_on_map) do
		
		local total_villages_count = 0
		
		function check_storage(xx1,yy1)
			local storage_result = false
			if storage then
				for ii=1,#storage,1 do
					if storage[ii][1] == xx1 then
						if storage[ii][2] == yy1 then
							storage_result = true
						end
					end
				end
			end
		return storage_result
		end
		
		function add_to_storage(xx1,yy1)
			if storage[1] then
				storage[#storage+1] = {}
				storage[#storage][1] = xx1
				storage[#storage][2] = yy1
			else
				storage[1] = {}
				storage[1][1] = xx1
				storage[1][2] = yy1
			end
		end
		
		local no_same_region_found = true
		function check_range_to_next_village(x1,y1,random_reg_name)
			for cc,loc_cc in ipairs(all_villas_on_map) do
				if total_villages_count <= (average_bonus + bonus_tolerance) then
					local distance_villa_to_villa = wesnoth.map.distance_between({ x1, y1 }, { loc_cc[1], loc_cc[2] })
					if distance_villa_to_villa <= (village_distance+iii) then
						if (x1 ~= loc_cc[1] or y1 ~= loc_cc[2]) then
							if check_storage(loc_cc[1],loc_cc[2]) == false then
								add_to_storage(loc_cc[1],loc_cc[2])
								total_villages_count = total_villages_count + 1
								--wesnoth.message("(Village #"..tostring(total_villages_count)..") "..tostring(loc_cc[1])..","..tostring(loc_cc[2]))
								--wesnoth.label {x=tostring(loc_cc[1]),y=tostring(loc_cc[2]),text=tostring(total_villages_count)..":"..tostring(random_reg_name),color={255,255,255,255}}
								no_same_region_found = false
								--wesnoth.delay(100)
								---if total_villages_count <= (average_bonus + bonus_tolerance) then
									check_range_to_next_village(loc_cc[1],loc_cc[2],random_reg_name)
								---else
								---	-- without break it still adds villages to storage and later gives them all names
								---	break
								---	--wesnoth.message("Bonus size exceeded for "..tostring(random_reg_name).." at "..tostring(loc_cc[1])..","..tostring(loc_cc[2]))
								---end
									
								-- if too many bonus regions then increase distance
							end
						end
					end
				else 
					break
				end
			end
		end
		
		
		local random_reg_name = helper.rand("England,Wales,Scotland,United States of America,Afghanistan,Albania,Algeria,Andorra,Angola,Argentina,Armenia,Australia,Austria,Azerbaijan,Bahamas,Bahrain,Bangladesh,Barbados, Belarus, Roman Empire, Belgium, Belize, Benin, Bhutan, Bolivia, Bosnia Herzegovina, Botswana, Brazil, Brunei, Bulgaria, Burkina, Burma, Burundi, Cambodia, Cameroon, Canada, Cape Verde, Central African Rep, Chad, Chile, People's Republic of China, Republic of China, Colombia, Comoros, Democratic Republic of the Congo, Republic of the Congo, Costa Rica,, Croatia, Cuba, Cyprus, Czech Republic, Danzig, Denmark, Djibouti, Dominica, Dominican Republic, East Timor, Ecuador, Egypt, El Salvador, Equatorial Guinea, Eritrea, Estonia, Ethiopia, Fiji, Finland, France, Gabon, Gaza Strip, The Gambia, Georgia, Germany, Ghana, Greece, Grenada, Guatemala, Guinea, Guinea-Bissau, Guyana, Haiti, Holy Roman Empire, Honduras, Hungary, Iceland, India, Indonesia, Iran, Iraq, Republic of Ireland, Israel, Italy, Ivory Coast, Jamaica, Japan, Jonathanland, Jordan, Kazakhstan, Kenya, Kiribati, North Korea, South Korea, Kosovo, Kuwait, Kyrgyzstan, Laos, Latvia, Lebanon, Lesotho, Liberia, Libya, Liechtenstein, Lithuania, Luxembourg, Macedonia, Madagascar, Malawi, Malaysia, Maldives, Mali, Malta, Marshall Islands, Mauritania, Mauritius, Mexico, Micronesia, Moldova, Monaco, Mongolia, Montenegro, Morocco, Mount Athos, Mozambique, Namibia, Nauru, Nepal, Newfoundland, Netherlands, New Zealand, Nicaragua, Niger, Nigeria, Norway, Oman, Ottoman Empire, Pakistan, Palau, Panama, Papua New Guinea, Paraguay, Peru, Philippines, Poland, Portugal, Prussia, Qatar, Romania, Rome, Russian Federation, Rwanda, St Lucia, Grenadines, Samoa, San Marino, Saudi Arabia, Senegal, Serbia, Seychelles, Sierra Leone, Singapore, Slovakia, Slovenia, Solomon Islands, Somalia, South Africa, Spain, Sri Lanka, Sudan, Suriname, Swaziland, Sweden, Switzerland, Syria, Tajikistan, Tanzania, Thailand, Togo, Tonga, Trinidad & Tobago, Tunisia, Turkey, Turkmenistan, Tuvalu, Uganda, Ukraine, United Arab Emirates, United Kingdom, Uruguay, Uzbekistan, Vanuatu, Vatican City, Venezuela, Vietnam, Yemen, Zambia, Zimbabwe")
		local string_find_i = string.find(random_reg_name," ")
		if string_find_i==1 then random_reg_name = string.gsub(random_reg_name," ","",1) end
		
		-- in future ideally delete +1 regions and try to increase distance to +3 maybe they become +2 or +3 or +4
		
		---local x01 = wesnoth.get_variable("x1")
		---local y01 = wesnoth.get_variable("y1")
		local x01 = loc_jj[1]
		local y01 = loc_jj[2]
		
		if check_storage(x01,y01) == false then
			region_count = region_count + 1
			add_to_storage(x01,y01)
			total_villages_count = total_villages_count + 1
			--wesnoth.message("(Village #"..tostring(total_villages_count)..") "..tostring(x01)..","..tostring(y01))
			--wesnoth.label {x=tostring(x01),y=tostring(y01),text=tostring(total_villages_count)..":"..tostring(random_reg_name),color={255,255,255,255}}
			check_range_to_next_village(x01,y01,random_reg_name)
			--memox = x01
			--memoy = y01
			if no_same_region_found == true then
				--wesnoth.message("no same region found for "..tostring(memox)..","..tostring(memoy).." (Village Distance: "..tostring(village_distance)..")")
			end
			local random_extra_bonus = helper.rand("1,2")
			local city_theme = helper.rand("1,2")
			local slowthinker_string_village_list = ""
			local slowthinker_bonus = total_villages_count
			for kk=#storage,#storage-total_villages_count+1,-1 do
				if total_villages_count > 1 then
					---wesnoth.label {x=tostring(storage[kk][1]),y=tostring(storage[kk][2]),text=tostring(pick_a_city_name(city_theme)).." ("..tostring(random_reg_name).." +"..tostring(total_villages_count+random_extra_bonus)..")",color={255,255,255,255}}
					slowthinker_bonus = total_villages_count+random_extra_bonus
				---else
					---slowthinker_bonus = total_villages_count
					---wesnoth.label {x=tostring(storage[kk][1]),y=tostring(storage[kk][2]),text=tostring(pick_a_city_name(city_theme)).." ("..tostring(random_reg_name).." +"..tostring(total_villages_count)..")",color={255,255,255,255}}
				end
				if kk == #storage then
					slowthinker_string_village_list = pick_a_city_name(city_theme)..","..storage[kk][1]..","..storage[kk][2]
				else
					slowthinker_string_village_list = slowthinker_string_village_list..","..pick_a_city_name(city_theme)..","..storage[kk][1]..","..storage[kk][2]
				end
			end
			---wesnoth.message(tostring(slowthinker_string_village_list))
			
						function slowthinker_region(region_name,region_bonus,village_list)
							---local region_name = cfg.name or helper.wml_error "[region] expects a name= attribute."
							---local region_bonus = cfg.bonus or helper.wml_error "[region] expects a bonus= attribute."
							---local village_list = cfg.village_list or helper.wml_error "[region] expects a village_list= attribute."
							---
							local region_codename = region_name
							-- may be bug with double empty spaces or double "-" signs in same region name etc
							if string.find(region_codename," ") then region_codename = string.gsub(region_codename," ","_") end
							if string.find(region_codename,"'") then region_codename = string.gsub(region_codename,"'","_") end
							if string.find(region_codename,"/") then region_codename = string.gsub(region_codename,"/","_") end
							if string.find(region_codename,"-") then region_codename = string.gsub(region_codename,"-","_") end
							---
							local lua_regions_length = wesnoth.get_variable("CE_SYSTEM.regions.length")
							if lua_regions_length then
							else lua_regions_length = 0
							end
							---
							wesnoth.set_variable("CE_SYSTEM.regions_"..tostring(region_codename).."_bonus",tostring(region_bonus))
							wesnoth.set_variable("CE_SYSTEM.regions_"..tostring(region_codename).."array_num",tostring(lua_regions_length))
							wesnoth.set_variable("CE_SYSTEM.regions["..tostring(lua_regions_length).."].id",tostring(region_codename))
							wesnoth.set_variable("CE_SYSTEM.regions["..tostring(lua_regions_length).."].bonus",tostring(region_bonus))
							wesnoth.set_variable("CE_SYSTEM.regions["..tostring(lua_regions_length).."].name",tostring(region_name))
							---
							local lua_previous = "y"
							local lua_village_x = -1
							local lua_village_y = -1
							local lua_village_name = "empty"
						-----------------------------------------------------------	
							local j = 0
							for eachword in string.gmatch(village_list, "([^,]+)") do
								j = j + 1
								if tonumber(eachword) ~= nil then
									if lua_previous == "string" then
										lua_previous = "x"
										lua_village_x = eachword
									else
										lua_previous = "y"
										lua_village_y = eachword
									end
								else
									lua_previous = "string"
									lua_village_name = eachword
								end
								-----------------------------------------------------
								if lua_previous == "y" then
								--------------------
									local lua_villages_length = wesnoth.get_variable("CE_SYSTEM.regions_"..tostring(region_codename)..".length")
									if lua_villages_length then
									else lua_villages_length = 0
									end
									---
									wesnoth.set_variable("CE_SYSTEM.regions_"..tostring(region_codename).."["..tostring(lua_villages_length).."].name",tostring(lua_village_name))
									wesnoth.set_variable("CE_SYSTEM.regions_"..tostring(region_codename).."["..tostring(lua_villages_length).."].x",tostring(lua_village_x))
									wesnoth.set_variable("CE_SYSTEM.regions_"..tostring(region_codename).."["..tostring(lua_villages_length).."].y",tostring(lua_village_y))
									wesnoth.set_variable("CE_SYSTEM.regions_city_"..tostring(lua_village_x).."_"..tostring(lua_village_y)..".name",tostring(lua_village_name))
									wesnoth.set_variable("CE_SYSTEM.regions_city_"..tostring(lua_village_x).."_"..tostring(lua_village_y)..".region_id",tostring(region_codename))
									wesnoth.set_variable("CE_SYSTEM.regions_city_"..tostring(lua_village_x).."_"..tostring(lua_village_y)..".array_num",tostring(lua_villages_length))
									---
									if wesnoth.get_variable("CE_SYSTEM.show_village_labels_in_fog") == true then
									wesnoth.fire("label", { text=tostring(lua_village_name).." ("..tostring(region_name).." +"..tostring(region_bonus)..")", color="200,200,200", x=tostring(lua_village_x), y=tostring(lua_village_y), category="", immutable="yes", side="0", team_name="", tooltip="", visible_in_fog="yes", visible_in_shroud="no" } )
									else
									wesnoth.fire("label", { text=tostring(lua_village_name).." ("..tostring(region_name).." +"..tostring(region_bonus)..")", color="200,200,200", x=tostring(lua_village_x), y=tostring(lua_village_y), category="", immutable="yes", side="0", team_name="", tooltip="", visible_in_fog="no", visible_in_shroud="no" } )
									end
									-------------
								else 
								end
							end
						--------------------------------------------------
						end
			slowthinker_region(tostring(random_reg_name),tostring(slowthinker_bonus),tostring(slowthinker_string_village_list))
			---wesnoth.fire("region",{ name=tostring(random_reg_name), bonus=tostring(slowthinker_bonus), village_list=tostring(slowthinker_string_village_list) })
			---[region]
			---	name=Free Tribes
			---	bonus=3
			---	village_list=Lestomysl,23,13,Maloslav,16,11,Slatihor,25,10
			---[/region]
			--- {CE_SET_REGION_BONUS Spain Spain 7}
			--- {CE_SET_LABEL 4 27 Porto (Spain)}
		end
	end
	--wesnoth.message("Number of regions is: "..tostring(region_count))
	
---	if (ideal_amount_of_regions+ideal_amount_of_regions/5) > region_count then
---		break
---	end
	
---end
			>>
			[/lua]
		[/command]
	[/set_menu_item]
	
## old lua code for automatic bonus distribution (never worked)
[lua]
code = <<
local random_names_generator_type = helper.rand("Real,Fairy")
		--------------------------
		function generate_random_name()
			local random_region_name = ""
			local region_assigned = false
			if region_name then
				if #region_name > 0 then
					while (region_assigned==false) do
						if random_names_generator_type == "Real" then 
							random_region_name = helper.rand("England,Wales,Scotland,United States of America,Afghanistan,Albania,Algeria,Andorra,Angola,Argentina,Armenia,Australia,Austria,Azerbaijan,Bahamas,Bahrain,Bangladesh,Barbados, Belarus, Roman Empire, Belgium, Belize, Benin, Bhutan, Bolivia, Bosnia Herzegovina, Botswana, Brazil, Brunei, Bulgaria, Burkina, Burma, Burundi, Cambodia, Cameroon, Canada, Cape Verde, Central African Rep, Chad, Chile, People's Republic of China, Republic of China, Colombia, Comoros, Democratic Republic of the Congo, Republic of the Congo, Costa Rica,, Croatia, Cuba, Cyprus, Czech Republic, Danzig, Denmark, Djibouti, Dominica, Dominican Republic, East Timor, Ecuador, Egypt, El Salvador, Equatorial Guinea, Eritrea, Estonia, Ethiopia, Fiji, Finland, France, Gabon, Gaza Strip, The Gambia, Georgia, Germany, Ghana, Greece, Grenada, Guatemala, Guinea, Guinea-Bissau, Guyana, Haiti, Holy Roman Empire, Honduras, Hungary, Iceland, India, Indonesia, Iran, Iraq, Republic of Ireland, Israel, Italy, Ivory Coast, Jamaica, Japan, Jonathanland, Jordan, Kazakhstan, Kenya, Kiribati, North Korea, South Korea, Kosovo, Kuwait, Kyrgyzstan, Laos, Latvia, Lebanon, Lesotho, Liberia, Libya, Liechtenstein, Lithuania, Luxembourg, Macedonia, Madagascar, Malawi, Malaysia, Maldives, Mali, Malta, Marshall Islands, Mauritania, Mauritius, Mexico, Micronesia, Moldova, Monaco, Mongolia, Montenegro, Morocco, Mount Athos, Mozambique, Namibia, Nauru, Nepal, Newfoundland, Netherlands, New Zealand, Nicaragua, Niger, Nigeria, Norway, Oman, Ottoman Empire, Pakistan, Palau, Panama, Papua New Guinea, Paraguay, Peru, Philippines, Poland, Portugal, Prussia, Qatar, Romania, Rome, Russian Federation, Rwanda, St Lucia, Grenadines, Samoa, San Marino, Saudi Arabia, Senegal, Serbia, Seychelles, Sierra Leone, Singapore, Slovakia, Slovenia, Solomon Islands, Somalia, South Africa, Spain, Sri Lanka, Sudan, Suriname, Swaziland, Sweden, Switzerland, Syria, Tajikistan, Tanzania, Thailand, Togo, Tonga, Trinidad & Tobago, Tunisia, Turkey, Turkmenistan, Tuvalu, Uganda, Ukraine, United Arab Emirates, United Kingdom, Uruguay, Uzbekistan, Vanuatu, Vatican City, Venezuela, Vietnam, Yemen, Zambia, Zimbabwe")
						else
							random_region_name = helper.rand("Wonderland,Magical Fields,Holy Land,Rainbows,Stormy,Lepriconia,Unicorns,Beasts,Clouds,Rivers,Lakes,Oceans,Tunnels,Great Tunnels,Forgotten Land,Hell,Paradise,Hell Hole,Holy Dust,Pyramids,Triangle,Frozen Wings,Winterland,Golden Edge,Sandland,Diamonds,Emeralds,New Land,Hopeless Rainfall,Joyfull Beasts,Tropics,Arctics,Jingle Bells,Jungle Bells,Wizards,Temples of Buddha,Sunrise,Sunshine,Eclipse,On the Moon,The Light,The Dark,Shadows,Trojan Horses,Solar Flares,Thunders,Storms,Broken Dreams,Spiderland,The Claws,Royals,Fairies,Jagged Rocks,Seven Suns,Harlem,Salem,Foggy Gates,Hungry Frogs,Magic Storm,Big Meal,Gummy Bears,Polar Snow,Peasants,Revolving Doors,Fireflies,Dragons,Black Dragons,Red Dragons,Blue Dragons,Pale Dragons,Melting Point,Existance,Last Resistance,Last Resort,Reserved,Pinguins,Guinea Pigs,Hamsters,Angry Hamsters,Shaolin,Ninja,Greenland,Smiles,Luna,Moon,Destiny,Kingdom,Ezra,Alpha,Omega,Sparks,Wet Leafs,Blue Skies,Sweet Dreams,Summer Sweat,Summerland,Faint Smell,Full of Life,Second Chance,Fruits,Vegetables,Arms of Balloo,Centaurs,Centuries,Pigeons,Seagulls,Eagles,Tangerines,Gorillas,Monkeys,Tiger Fist,Hard as Rock,Soft Palms,Event Horisont,Goldilocks,Braveyard,El Gato,Summer Ray,The Blessing,Giraffas,Milky Way,Farmland,Healthy Crops,Tomatoes,Cucumbers,Carrots,Renegates,Domingo,Bacteria,Super Nova,Sierra,Kamasutra,Nuru,Bamboo,Stars,Shiny Stars,Lone Soles,Cherries,Christmas,New Land,Escape,Peaches,Plums,Utopia,Liquid Water,Vega,Wisky,Eyeballs,Next,Underground,Lime,Lemon,Odin,Raa,Monks,Cola,Afternoon,Cyrus,Andromeda,Twins,Hoplite,Phalanx,Legion,Pasture,Stoned,Phoenix,Beetles,Jawa,Hogar,Hogor,Hong,Hool,Horbag,Hork,Hort,Hoshnak,Hudash,Hudish,Hugor,Huk,Hulg,Hulo,Hunk,Huol,Hurag,Hurbag,Hurk,Hushnak,Huurk,Pagdish,Pagor,Palg,Palo,Paol,Parag,Pashnak,Pidush,Pigdish,Pigdush,Pilg,Pinak,Pink,Pirbag,Podash,Podish,Podush,Pogdish,Polg,Porbag,Porg,Pork,Port,Poshnak,Pradish,Pragdush,Pragor,Pralg,Pralo,Prang,Praol,Prarag,Prarbag,Prarg,Prark,Prart,Prashnak,Praurk,Pridish,Prigar,Prigdish,Prigor,Prilg,Prilo,Prinak,Priol,Prirbag,Prirg,Prirt,Priurk,Prodash,Prodish,Prodush,Prolg,Prolo,Pronak,Prong,Pronk,Prool,Prourk,Prudish,Prugar,Prugdish,Pruk,Prunak,Prunk,Prurg,Prurk,Pruurk,Puk,Pulg,Pulo,Punak,Pung,Punk,Purag,Purbag,Purg,Puurk,Radash,Ragar,Ragdish,Rak,Rang,Rank,Raol,Rarag,Rarbag,Rark,Rashnak,Raurk,Rigor,Rik,Rilg,Rinak,Rink,Rirg,Rirk,Rodish,Rodush,Rogdish,Rok,Rolo,Ronak,Rudash,Rugar,Rugdish,Ruk,Rung,Ruol,Rurag,Rushnak,Vadash,Vadish,Vadush,Vak,Valo,Vank,Varag,Varbag,Vigar,Vigdish,Vigor,Vilg,Vilo,Vink,Virag,Virt,Vishnak,Vogdish,Vogor,Vonak,Vong,Vorg,Vork,Voshnak,Vourk,Vradash,Vragar,Vragdush,Vragor,Vralo,Vrang,Vrarbag,Vrarg,Vrart,Vraurk,Vridash,Vridish,Vrigor,Vrik,Vrinak,Vring,Vrirt,Vrishnak,Vriurk,Vrodash,Vrodish,Vrogar,Vrogor,Vrolo,Vrong,Vrorg,Vrork,Vrudish,Vrugdush,Vrulg,Vrung,Vruol,Vrurg,Vrurt,Vruurk,Vudish,Vuk,Vulg,Vulo,Vunak,Vurag,Vurbag,Vurg,Vushnak") 
						end
						local region_already_exist = false
						--for u,#region_name,1 do
						--	if random_region_name == region_name[u] then
						--		region_already_exist = true
						--		break
						--	end
						--end
						if region_already_exist == false then
							region_assigned = true
						end
					end
				end
			end
		return random_region_name
		end
		--------------------------
		local all_villas_on_map = wesnoth.get_villages()
		local total_villages_count = 0
		local no_same_region_found = true
		function check_range_to_next_village(x1,y1)
			for cc,loc_cc in ipairs(all_villas_on_map) do
				local distance_villa_to_villa = wesnoth.map.distance_between({ x1, y1 }, { loc_cc[1], loc_cc[2] })
				if distance_villa_to_villa <= village_distance then
					if x1 ~= loc_cc[1] then
						if y1 ~= loc_cc[2] then
							total_villages_count = total_villages_count + 1
							wesnoth.message("(Village #"..tostring(total_villages_count)..") Distance from "..tostring(x1)..","..tostring(y1).." to "..tostring(loc_cc[1])..","..tostring(loc_cc[2]).." = "..tostring(distance_villa_to_villa))
							no_same_region_found = false
							wesnoth.delay(100)
							check_range_to_next_village(loc_cc[1],loc_cc[2])
						end
					end
				end
			end
		end
		local memox = 0
		local memoy = 0
		for i,loc_i in ipairs(all_villas_on_map) do
			if i == 1 then
				check_range_to_next_village(loc_i[1],loc_i[2])
				memox = loc_i[1]
				memoy = loc_i[2]
			end
		end
		if no_same_region_found == true then
			wesnoth.message("no same region found for "..tostring(memox)..","..tostring(memoy).."(Village Distance: "..tostring(village_distance)..")")
		end
		
		--for i,loc_i in ipairs(all_villas_on_map) do
			--for j,loc_j in ipairs(all_villas_on_map) do
				--local distance_villa_i_villa_j = wesnoth.map.distance_between({ loc_i[1], loc_i[2] }, { loc_j[1], loc_j[2] })
				--if region_name[i][1] == nil then
					---region_name[i][1] = generate_random_name()
				--end
				--if distance_villa_i_villa_j <= village_distance then
					--if j ~= i then
					--end
				--end
			--end
		--end
		
		--for i,#region_name,1 do
			--[region]
			--	name=Free Tribes
			--	bonus=3
			--	village_list=Lestomysl,23,13,Maloslav,16,11,Slatihor,25,10
			--[/region]
			-- {CE_SET_REGION_BONUS Spain Spain 7}
			-- {CE_SET_LABEL 4 27 Porto (Spain)}
		--end
		-- distribute bonuses
		-- or store location all villages.. and for each villa.. store locations of radius
		-- for x,y each hex store each x y villa that was already done in process into array
		-- store locations in village distance radius (if found then join them into same region name)
		
>>
[/lua]


## the below works quite well just needed to change ~= into == else
[set_menu_item]
		id=aaa_ce_testregion
		description=_"<b>Test Region.</b>"
		image=themes/villages.png
		[command]
			[lua]
			code = <<
		local w,h,b = wesnoth.get_map_size()
		for i=0,w+1,1 do
			for j=h+1,h-1,-1 do
				wesnoth.set_terrain(i, j, "Xv")
			end
		end
		
		local village_distance = helper.round((h+w)/2/10)
		local village_distance_tolerance = helper.round(village_distance/5)
		local ideal_village_count = helper.round((h+w)/2*1.4)
		local average_bonus = helper.round(ideal_village_count/10)
		local bonus_tolerance = helper.round(average_bonus/5)
			
		local all_villas_on_map = wesnoth.get_villages()
		local storage = {}
		
		
		
		-- while region counter > (village_count / average_bonus * 2) do increase region distance 
		-- if region_distance > 10 then break
		-- region counter = 0
		-- for i,loc,allvillages in pairs bla bla
		-- repeat below thing for all villages on map
		-- skip the village with already assigned region name
		-- create bonus amount depending on village counter. 
		-- (1 village +1)(2 villages +2 or +3) (3 villages +3+4) (4 villages +4+5+6) (5 villages +5+6+7)
		
---	for jj,loc_jj in ipairs(all_villas_on_map) do
		
		local total_villages_count = 0
		
		function check_storage(xx1,yy1)
			local storage_result = false
			if storage then
				for ii=1,#storage,1 do
					if storage[ii][1] == xx1 then
						if storage[ii][2] == yy1 then
							storage_result = true
						end
					end
				end
			end
		return storage_result
		end
		
		function add_to_storage(xx1,yy1)
			if storage[1] then
				--wesnoth.message(tostring(xx1))
				--wesnoth.message(tostring(yy1))
				--wesnoth.message(tostring(#storage))
				--wesnoth.message(tostring(storage[1][1]))
				--wesnoth.message(tostring(storage[1][2]))
				storage[#storage+1] = {}
				storage[#storage][1] = xx1
				storage[#storage][2] = yy1
			else
				--wesnoth.message("initializing storage")
				storage[1] = {}
				storage[1][1] = xx1
				storage[1][2] = yy1
				--wesnoth.message("done")
			end
		end
		
		local no_same_region_found = true
		function check_range_to_next_village(x1,y1,random_reg_name)
			for cc,loc_cc in ipairs(all_villas_on_map) do
				local distance_villa_to_villa = wesnoth.map.distance_between({ x1, y1 }, { loc_cc[1], loc_cc[2] })
				if distance_villa_to_villa <= (village_distance+1) then
					if x1 ~= loc_cc[1] then
						if y1 ~= loc_cc[2] then
							if check_storage(loc_cc[1],loc_cc[2]) == false then
								add_to_storage(loc_cc[1],loc_cc[2])
								total_villages_count = total_villages_count + 1
								--wesnoth.message("(Village #"..tostring(total_villages_count)..") Distance from "..tostring(x1)..","..tostring(y1).." to "..tostring(loc_cc[1])..","..tostring(loc_cc[2]).." = "..tostring(distance_villa_to_villa))
								wesnoth.message("(Village #"..tostring(total_villages_count)..") "..tostring(loc_cc[1])..","..tostring(loc_cc[2]))
								wesnoth.label {x=tostring(loc_cc[1]),y=tostring(loc_cc[2]),text=tostring(total_villages_count)..":"..tostring(random_reg_name),color={255,255,255,255}}
								no_same_region_found = false
								wesnoth.delay(100)
								check_range_to_next_village(loc_cc[1],loc_cc[2],random_reg_name)
							end
						end
					end
				end
			end
		end
		
		
		
		local random_reg_name = helper.rand("England,Wales,Scotland,United States of America,Afghanistan,Albania,Algeria,Andorra,Angola,Argentina,Armenia,Australia,Austria,Azerbaijan,Bahamas,Bahrain,Bangladesh,Barbados, Belarus, Roman Empire, Belgium, Belize, Benin, Bhutan, Bolivia, Bosnia Herzegovina, Botswana, Brazil, Brunei, Bulgaria, Burkina, Burma, Burundi, Cambodia, Cameroon, Canada, Cape Verde, Central African Rep, Chad, Chile, People's Republic of China, Republic of China, Colombia, Comoros, Democratic Republic of the Congo, Republic of the Congo, Costa Rica,, Croatia, Cuba, Cyprus, Czech Republic, Danzig, Denmark, Djibouti, Dominica, Dominican Republic, East Timor, Ecuador, Egypt, El Salvador, Equatorial Guinea, Eritrea, Estonia, Ethiopia, Fiji, Finland, France, Gabon, Gaza Strip, The Gambia, Georgia, Germany, Ghana, Greece, Grenada, Guatemala, Guinea, Guinea-Bissau, Guyana, Haiti, Holy Roman Empire, Honduras, Hungary, Iceland, India, Indonesia, Iran, Iraq, Republic of Ireland, Israel, Italy, Ivory Coast, Jamaica, Japan, Jonathanland, Jordan, Kazakhstan, Kenya, Kiribati, North Korea, South Korea, Kosovo, Kuwait, Kyrgyzstan, Laos, Latvia, Lebanon, Lesotho, Liberia, Libya, Liechtenstein, Lithuania, Luxembourg, Macedonia, Madagascar, Malawi, Malaysia, Maldives, Mali, Malta, Marshall Islands, Mauritania, Mauritius, Mexico, Micronesia, Moldova, Monaco, Mongolia, Montenegro, Morocco, Mount Athos, Mozambique, Namibia, Nauru, Nepal, Newfoundland, Netherlands, New Zealand, Nicaragua, Niger, Nigeria, Norway, Oman, Ottoman Empire, Pakistan, Palau, Panama, Papua New Guinea, Paraguay, Peru, Philippines, Poland, Portugal, Prussia, Qatar, Romania, Rome, Russian Federation, Rwanda, St Lucia, Grenadines, Samoa, San Marino, Saudi Arabia, Senegal, Serbia, Seychelles, Sierra Leone, Singapore, Slovakia, Slovenia, Solomon Islands, Somalia, South Africa, Spain, Sri Lanka, Sudan, Suriname, Swaziland, Sweden, Switzerland, Syria, Tajikistan, Tanzania, Thailand, Togo, Tonga, Trinidad & Tobago, Tunisia, Turkey, Turkmenistan, Tuvalu, Uganda, Ukraine, United Arab Emirates, United Kingdom, Uruguay, Uzbekistan, Vanuatu, Vatican City, Venezuela, Vietnam, Yemen, Zambia, Zimbabwe")
		
		local x01 = wesnoth.get_variable("x1")
		local y01 = wesnoth.get_variable("y1")
		---local x01 = loc_jj[1]
		---local y01 = loc_jj[2]
		
		if check_storage(x01,y01) == false then
			add_to_storage(x01,y01)
			total_villages_count = total_villages_count + 1
			---wesnoth.message("(Village #"..tostring(total_villages_count)..") Distance from "..tostring(x01)..","..tostring(y01).." to "..tostring(loc_cc[1])..","..tostring(loc_cc[2]).." = "..tostring(distance_villa_to_villa))
			wesnoth.message("(Village #"..tostring(total_villages_count)..") "..tostring(x01)..","..tostring(y01))
			wesnoth.label {x=tostring(x01),y=tostring(y01),text=tostring(total_villages_count)..":"..tostring(random_reg_name),color={255,255,255,255}}
			check_range_to_next_village(x01,y01,random_reg_name)
			memox = x01
			memoy = y01
			if no_same_region_found == true then
				wesnoth.message("no same region found for "..tostring(memox)..","..tostring(memoy).." (Village Distance: "..tostring(village_distance)..")")
			end
		end
---	end
			>>
			[/lua]
		[/command]
	[/set_menu_item]
	
	[set_menu_item]
		id=aab_ce_testd
		description=_"<b>Distance from.</b>"
		image=themes/villages.png
		[command]
		{VARIABLE d1x $x1}
		{VARIABLE d1y $y1}
		[/command]
	[/set_menu_item]
	[set_menu_item]
		id=aac_ce_testd
		description=_"<b>Distance to.</b>"
		image=themes/villages.png
		[command]
		{VARIABLE d2x $x1}
		{VARIABLE d2y $y1}
		[lua]
		code = <<
		wesnoth.message(tostring(wesnoth.map.distance_between({ wesnoth.get_variable("d1x"), wesnoth.get_variable("d1y") }, { wesnoth.get_variable("d2x"), wesnoth.get_variable("d2y") }) ))
		>>
		[/lua]
		[/command]
	[/set_menu_item]

[lua]
code = <<
wesnoth.message("Distributing bonuses")
		local stamp_begin = wesnoth.get_time_stamp()
		---
		local random_names_generator_type = helper.rand("Real,Fairy")
		--------------------------
		function generate_random_name()
			local random_region_name = ""
			local region_assigned = false
			if region_name then
				if #region_name > 0 then
					while (region_assigned==false) do
						if random_names_generator_type == "Real" then 
							random_region_name = helper.rand("England,Wales,Scotland,United States of America,Afghanistan,Albania,Algeria,Andorra,Angola,Argentina,Armenia,Australia,Austria,Azerbaijan,Bahamas,Bahrain,Bangladesh,Barbados, Belarus, Roman Empire, Belgium, Belize, Benin, Bhutan, Bolivia, Bosnia Herzegovina, Botswana, Brazil, Brunei, Bulgaria, Burkina, Burma, Burundi, Cambodia, Cameroon, Canada, Cape Verde, Central African Rep, Chad, Chile, People's Republic of China, Republic of China, Colombia, Comoros, Democratic Republic of the Congo, Republic of the Congo, Costa Rica,, Croatia, Cuba, Cyprus, Czech Republic, Danzig, Denmark, Djibouti, Dominica, Dominican Republic, East Timor, Ecuador, Egypt, El Salvador, Equatorial Guinea, Eritrea, Estonia, Ethiopia, Fiji, Finland, France, Gabon, Gaza Strip, The Gambia, Georgia, Germany, Ghana, Greece, Grenada, Guatemala, Guinea, Guinea-Bissau, Guyana, Haiti, Holy Roman Empire, Honduras, Hungary, Iceland, India, Indonesia, Iran, Iraq, Republic of Ireland, Israel, Italy, Ivory Coast, Jamaica, Japan, Jonathanland, Jordan, Kazakhstan, Kenya, Kiribati, North Korea, South Korea, Kosovo, Kuwait, Kyrgyzstan, Laos, Latvia, Lebanon, Lesotho, Liberia, Libya, Liechtenstein, Lithuania, Luxembourg, Macedonia, Madagascar, Malawi, Malaysia, Maldives, Mali, Malta, Marshall Islands, Mauritania, Mauritius, Mexico, Micronesia, Moldova, Monaco, Mongolia, Montenegro, Morocco, Mount Athos, Mozambique, Namibia, Nauru, Nepal, Newfoundland, Netherlands, New Zealand, Nicaragua, Niger, Nigeria, Norway, Oman, Ottoman Empire, Pakistan, Palau, Panama, Papua New Guinea, Paraguay, Peru, Philippines, Poland, Portugal, Prussia, Qatar, Romania, Rome, Russian Federation, Rwanda, St Lucia, Grenadines, Samoa, San Marino, Saudi Arabia, Senegal, Serbia, Seychelles, Sierra Leone, Singapore, Slovakia, Slovenia, Solomon Islands, Somalia, South Africa, Spain, Sri Lanka, Sudan, Suriname, Swaziland, Sweden, Switzerland, Syria, Tajikistan, Tanzania, Thailand, Togo, Tonga, Trinidad & Tobago, Tunisia, Turkey, Turkmenistan, Tuvalu, Uganda, Ukraine, United Arab Emirates, United Kingdom, Uruguay, Uzbekistan, Vanuatu, Vatican City, Venezuela, Vietnam, Yemen, Zambia, Zimbabwe")
						else
							random_region_name = helper.rand("Wonderland,Magical Fields,Holy Land,Rainbows,Stormy,Lepriconia,Unicorns,Beasts,Clouds,Rivers,Lakes,Oceans,Tunnels,Great Tunnels,Forgotten Land,Hell,Paradise,Hell Hole,Holy Dust,Pyramids,Triangle,Frozen Wings,Winterland,Golden Edge,Sandland,Diamonds,Emeralds,New Land,Hopeless Rainfall,Joyfull Beasts,Tropics,Arctics,Jingle Bells,Jungle Bells,Wizards,Temples of Buddha,Sunrise,Sunshine,Eclipse,On the Moon,The Light,The Dark,Shadows,Trojan Horses,Solar Flares,Thunders,Storms,Broken Dreams,Spiderland,The Claws,Royals,Fairies,Jagged Rocks,Seven Suns,Harlem,Salem,Foggy Gates,Hungry Frogs,Magic Storm,Big Meal,Gummy Bears,Polar Snow,Peasants,Revolving Doors,Fireflies,Dragons,Black Dragons,Red Dragons,Blue Dragons,Pale Dragons,Melting Point,Existance,Last Resistance,Last Resort,Reserved,Pinguins,Guinea Pigs,Hamsters,Angry Hamsters,Shaolin,Ninja,Greenland,Smiles,Luna,Moon,Destiny,Kingdom,Ezra,Alpha,Omega,Sparks,Wet Leafs,Blue Skies,Sweet Dreams,Summer Sweat,Summerland,Faint Smell,Full of Life,Second Chance,Fruits,Vegetables,Arms of Balloo,Centaurs,Centuries,Pigeons,Seagulls,Eagles,Tangerines,Gorillas,Monkeys,Tiger Fist,Hard as Rock,Soft Palms,Event Horisont,Goldilocks,Braveyard,El Gato,Summer Ray,The Blessing,Giraffas,Milky Way,Farmland,Healthy Crops,Tomatoes,Cucumbers,Carrots,Renegates,Domingo,Bacteria,Super Nova,Sierra,Kamasutra,Nuru,Bamboo,Stars,Shiny Stars,Lone Soles,Cherries,Christmas,New Land,Escape,Peaches,Plums,Utopia,Liquid Water,Vega,Wisky,Eyeballs,Next,Underground,Lime,Lemon,Odin,Raa,Monks,Cola,Afternoon,Cyrus,Andromeda,Twins,Hoplite,Phalanx,Legion,Pasture,Stoned,Phoenix,Beetles,Jawa,Hogar,Hogor,Hong,Hool,Horbag,Hork,Hort,Hoshnak,Hudash,Hudish,Hugor,Huk,Hulg,Hulo,Hunk,Huol,Hurag,Hurbag,Hurk,Hushnak,Huurk,Pagdish,Pagor,Palg,Palo,Paol,Parag,Pashnak,Pidush,Pigdish,Pigdush,Pilg,Pinak,Pink,Pirbag,Podash,Podish,Podush,Pogdish,Polg,Porbag,Porg,Pork,Port,Poshnak,Pradish,Pragdush,Pragor,Pralg,Pralo,Prang,Praol,Prarag,Prarbag,Prarg,Prark,Prart,Prashnak,Praurk,Pridish,Prigar,Prigdish,Prigor,Prilg,Prilo,Prinak,Priol,Prirbag,Prirg,Prirt,Priurk,Prodash,Prodish,Prodush,Prolg,Prolo,Pronak,Prong,Pronk,Prool,Prourk,Prudish,Prugar,Prugdish,Pruk,Prunak,Prunk,Prurg,Prurk,Pruurk,Puk,Pulg,Pulo,Punak,Pung,Punk,Purag,Purbag,Purg,Puurk,Radash,Ragar,Ragdish,Rak,Rang,Rank,Raol,Rarag,Rarbag,Rark,Rashnak,Raurk,Rigor,Rik,Rilg,Rinak,Rink,Rirg,Rirk,Rodish,Rodush,Rogdish,Rok,Rolo,Ronak,Rudash,Rugar,Rugdish,Ruk,Rung,Ruol,Rurag,Rushnak,Vadash,Vadish,Vadush,Vak,Valo,Vank,Varag,Varbag,Vigar,Vigdish,Vigor,Vilg,Vilo,Vink,Virag,Virt,Vishnak,Vogdish,Vogor,Vonak,Vong,Vorg,Vork,Voshnak,Vourk,Vradash,Vragar,Vragdush,Vragor,Vralo,Vrang,Vrarbag,Vrarg,Vrart,Vraurk,Vridash,Vridish,Vrigor,Vrik,Vrinak,Vring,Vrirt,Vrishnak,Vriurk,Vrodash,Vrodish,Vrogar,Vrogor,Vrolo,Vrong,Vrorg,Vrork,Vrudish,Vrugdush,Vrulg,Vrung,Vruol,Vrurg,Vrurt,Vruurk,Vudish,Vuk,Vulg,Vulo,Vunak,Vurag,Vurbag,Vurg,Vushnak") )
						end
						local region_already_exist = false
						for u,#region_name,1 do
							if random_region_name == region_name[u] then
								region_already_exist = true
								break
							end
						end
						if region_already_exist == false then
							region_assigned = true
						end
					end
				end
			end
		return random_region_name
		end
		--------------------------
		local all_villas_on_map = wesnoth.get_villages()
		local region_name = {}
		local distance_exceeded = false
		---while (distance_exceeded == false) do
		--local average_bonus_counter = 0
		for i,loc_i in ipairs(all_villas_on_map) do
			region_name[i] = {}
			region_name[i][2] = loc_i[1]
			region_name[i][3] = loc_i[2]
			region_name[i][4] = helper.rand("London,Paris,New York,Washington,Tokyo,Kioto,Riga,Moscow,Vilnius,Klaipeda,Pussy,Astra,Opel,Kio")
			for j,loc_j in ipairs(all_villas_on_map) do
				local distance_villa_i_villa_j = wesnoth.map.distance_between({ loc_i[1], loc_i[2] }, { loc_j[1], loc_j[2] })
				if region_name[i][1] == nil then
					region_name[i][1] = generate_random_name()
				end
				if distance_villa_i_villa_j <= village_distance then
					if j ~= i then
						--average_bonus_counter = average_bonus_counter + 1
						if region_name[j][1] == nil then
							region_name[j][1] = region_name[i][1]
						else
							region_name[i][1] = region_name[j][1]
						end
						---for k,loc_k in ipairs(all_villas_on_map) do
							---if i ~= k then
								---local distance_villa_j_villa_k = wesnoth.map.distance_between({ loc_k[1], loc_k[2] }, { loc_j[1], loc_j[2] })
								---if distance_villa_j_villa_k <= village_distance then
									---if j ~= k then
										---region_name[j] = region_name[i]
									---end
								---end
							---end
						---end
					end
				--else
					-- different region name
					-- run for k to ipairs and h to ipairs for village j and see if it can catch any same region
					-- assign same name if it caught anything.
					-- if not then assign different region name to it
				end
			end
		---end
		end
		for i,#region_name,1 do
			--[region]
			--	name=Free Tribes
			--	bonus=3
			--	village_list=Lestomysl,23,13,Maloslav,16,11,Slatihor,25,10
			--[/region]
			-- {CE_SET_REGION_BONUS Spain Spain 7}
			-- {CE_SET_LABEL 4 27 Porto (Spain)}
		end
		-- distribute bonuses
		-- or store location all villages.. and for each villa.. store locations of radius
		-- for x,y each hex store each x y villa that was already done in process into array
		-- store locations in village distance radius (if found then join them into same region name)
		
		---
		local stamp_end = wesnoth.get_time_stamp()
		wesnoth.message(tostring(stamp_end-stamp_begin))


		
		
		

local village_distance = helper.round((h+w)/2/10)
		local village_distance_tolerance = helper.round(village_distance/5)
		local ideal_village_count = helper.round((h+w)/2*1.4)
		local average_bonus = helper.round(ideal_village_count/10)
		local bonus_tolerance = helper.round(average_bonus/5)
		---wesnoth.message(tostring(village_distance))
		local end_of_village_placement = false
		local village_count = 0
		while (end_of_village_placement==false) do
			local x = helper.rand("1.."..w)
			local y = helper.rand("1.."..h)
			local random_village_location = wesnoth.get_locations { radius=tostring(village_distance), x=tostring(x), y=tostring(y) }
			if random_village_location then
				local other_village_present = false
				local potential_x = 0
				local potential_y = 0
				for i,loc in ipairs(random_village_location) do
					if wesnoth.match_location(loc[1], loc[2], { terrain="Gg^Vh" }) == true then
						other_village_present = true
						break
					end
				end
				if other_village_present == false then
					for i,loc in ipairs(random_village_location) do
						if wesnoth.match_location(loc[1], loc[2], { terrain="W*,W*^*,Xv" }) == false then
							wesnoth.set_terrain(loc[1], loc[2], "Gg^Vh")
							village_count = village_count + 1
							break
						end
					end
				end
			end
			if village_count >= ideal_village_count then
				end_of_village_placement = true
			end
			-- stick village in random place on map
			-- build cluster of villas around
		end
>>
[/lua]
#enddef
