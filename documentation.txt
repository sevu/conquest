Welcome!

1) For translating, see translation-info.txt in translations directory.

2) All files in this add-on are plain text files, just like this one.
   They have different file extensions, but technically you can rename them as you want.

   Any editor for text files works to edit them. (Only the Windows programm named "Editor" has a problem displaying line breaks).
   Even things like LibreOffice Writer can display and edit the files. I used Sublime Text.

   However, life is easier if you install an editor with syntax highlighting. See this forum thread:
   https://r.wesnoth.org/t13799

   It's learning by doing and looking around at what exists.

3) Have fun!
   Rest of this file is mostly things I noted down once,
   and didn't delete in case they are useful for someone else too.

   Not things I wrote when the code was written, but when I tried to understand it.


4) Overview over events:
   I noted here down what events exist. This was mostly to help me get an overview.
   They are listed in the order of execution, usually each line being one event.

For events with the same "name" it depends on which is included first into the scenario file.
But to ensure the order, these few events have "priority=1" assigned in these cases.
(While the priority key guarantees the order, it worked correct without too)

Events, ordered by execution time:

- preload
  Various Lua things (have to be here)

- prestart
  setting variable for enabling realm mode
  lower gold by 25 down to 0 (in prestart so status table shows this changed value as initial value)
  set_menu_item for recruit menus (previously in start)
  set_menu_item for board/disembark boats (previously in prestart)
  place village labels (previously in turn 1)
  adding objectives [priority=-1]


- start

- turn 1
  place village labels (on random maps)
  droid menu (should be prestart)
  select game length (not anymore, removed)

- new turn
- side turn
- side turn 1

- turn refresh
  Ask player to select game mode
  capitol mode / all village mode (if chosen)
  insert capture event (now after capitol mode won't trigger it) [priority=-1]

- turn 1 refresh
  reveal leaders (for Alliances Mod)
  realm mode (if chosen); NEEDS to happen after the capture event was inserted

- turn 2
  place neutral units from selected theme [priority=1]
  neutrals growth [happens afterwards, allowing to check if neutrals exist]

- side turn 2

- time over
  custom time over event [priority=1]


Random Map generators have additionally some more events, which are not listed here.


5) The regions are defined with the variables below:

For each region:
CE_SYSTEM.regions_Zacony_bonus = 7
CE_SYSTEM.regions_Zaconyarray_num   is unused (is 3)
CE_SYSTEM.regions_Zacony_array_num  is unused (is 3)
CE_SYSTEM.regions[3].id = Zacony
CE_SYSTEM.regions[3].bonus = 7
CE_SYSTEM.regions[3].name = Zacony

For each village of a region:
CE_SYSTEM.regions_Zacony[0].name = of the village
CE_SYSTEM.regions_Zacony[0].x
CE_SYSTEM.regions_Zacony[0].y
CE_SYSTEM.regions_city_X_Y.name = of the village
CE_SYSTEM.regions_city_X_Y.region_id = Zacony
CE_SYSTEM.regions_city_X_Y.array_num is unsed


So, seems all the data is stored twice. Not all is used.
The macros to create regions use a few values which the rest doesn't.

For the
- tag to create regions
- calculation of the bonus every turn
- region based unit spawns
WE CAN SUM UP:

That there exists one array with all regions is used to iterate over them.

CE_SYSTEM.regions[3].bonus is used
CE_SYSTEM.regions[3].id = is used only to access the next tag which has more information
CE_SYSTEM.regions_Zacony[0].x and y are used

CE_SYSTEM.regions_Zacony[0].name is unused
CE_SYSTEM.regions[3].name = Zacony is unused

CE_SYSTEM.regions_Zacony   without index is same as index 0 and unused
CE_SYSTEM.regions_city_X_Y completely unused


6) A cutom wml tag is defined via Lua in region_tag.lua:

[region]
    color=red,green,blue notation, e.g. color=107,140,125 (same as hexadecimal #6b8c7d)
    name=regionname (and an internal id will be derived from it)
    bonus=number
    village_list=name,x,y and repeat
[/region]

Alternatively, the map_regions_macros can be used to set up the labels and regions.

7) If you know how to start programms from command line on your operating system,
   you can speed up starting a game for testing. Here some commands for copy-paste:


Testing quickly:
A game can be started from the command line, saving clicks.

# Testing a map with Realm mode:
wesnoth -d -m --scenario=Conquest_Wesnoth --controller 1:null --controller 3:null --controller 5:null --controller 6:null

# Testing a map with many villages:
wesnoth -d -m --scenario=Conquest_Surdmark --controller 1:null --controller 3:null --controller 5:null --controller 6:null

# A map with AI enabled:
wesnoth -d -m --scenario=Conquest_Europe --controller 1:null --controller 2:null --controller 4:ai --controller 5:null --controller 6:null


What about Random Map Generators, maybe they can be started from command line too â€¦

One thing to know:
[options], which one can set when creating the game in the lobby, are ignored.
Their default values are not used either!
Instead, the code of this add-on takes care to not crash in this case :-p

(This is bcause [options] were added to Wesnoth later.)


8) About checking numbers regarding performance.
   Firstly, there is no point in doing that. But noted down how I did it here:

In Wesnoth's cache directory, this addon's (compressed) cache files are the ones with
45b13290b2e7d7304875e44f88689881, e.g.
cache-v1.18.0-45b13290b2e7d7304875e44f88689881.gz

One can see the size of the generated cache file.
The command below will create the same as the cache file, but uncompressed.

To compare how long the generation takes (happens when entrering the mp lobby),
one can preprocess the add-on on command-line, with:
wesnoth --preprocess-defines=MULTIPLAYER -p Conquest_Asterisk /tmp/

However, it does not matter.
